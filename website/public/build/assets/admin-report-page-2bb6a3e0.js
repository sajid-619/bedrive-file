import{a as K,b as O,j as e,c as p,ax as U,T as x,r as d,ak as W,aS as q,cI as Q,bI as Z,cg as k,bo as J,c6 as b,t as X,u as Y,cJ as S,m as v,cK as I,g as ee,s as L,f as se,D as te,n as ae,o as re,B as P,al as ie,d as B,aR as ne,z as oe}from"./main-97137759.js";import{T as le,a as ce,b as me}from"./TrendingUp-95298f8a.js";import{R as de,a4 as M,a5 as V,a6 as ue,a7 as xe,a8 as ge,a9 as fe}from"./UnfoldMore-d3e3f3ab.js";import{t as z,F as he}from"./admin-routes-f190288a.js";import"./Edit-fdaf8b96.js";import"./use-resume-subscription-d050c7a9.js";const $="admin/reports";function pe(s={}){return K([$,s],()=>je(s),{keepPreviousData:!0})}function je({types:s,dateRange:t}){const a={};return s&&(a.types=s.join(",")),t&&(a.startDate=t.start.toAbsoluteString(),a.endDate=t.end.toAbsoluteString(),a.timezone=t.start.timeZone),O.get($,{params:a}).then(r=>r.data)}function H(s){const{title:t,description:a,children:r,className:i,contentIsFlex:n=!0,contentClassName:c,contentRef:o,minHeight:m="min-h-440"}=s;return e.jsxs("div",{className:p("bg border rounded h-full flex flex-col flex-auto",m,i),children:[e.jsxs("div",{className:"text-xs p-14 flex-shrink-0 flex justify-between items-center",children:[e.jsx("div",{className:"font-semibold text-sm",children:t}),a&&e.jsx("div",{className:"text-muted",children:a})]}),e.jsx("div",{ref:o,className:p("p-14 relative",n&&"flex-auto flex items-center justify-center",c),children:r})]})}function N(){return e.jsxs("div",{className:"flex items-center gap-10 text-sm absolute mx-auto",children:[e.jsx(U,{isIndeterminate:!0,size:"sm"}),e.jsx(x,{message:"Chart loading"})]})}const be=d.lazy(()=>W(()=>import("./lazy-chart-58cdb71f.js"),["./lazy-chart-58cdb71f.js","./main-97137759.js","./main-6a1f3eb0.css"],import.meta.url));function w(s){const{title:t,description:a,className:r,contentRef:i,isLoading:n}=s;return e.jsx(H,{title:t,description:a,className:r,contentRef:i,children:e.jsxs(d.Suspense,{fallback:e.jsx(N,{}),children:[e.jsx(be,{...s}),n&&e.jsx(N,{})]})})}function y(s,{localeCode:t="en",shareFirstDatasetLabels:a=!0}){if(!s)return{datasets:[]};const r=[];return{...s,datasets:s.datasets.map((i,n)=>{const c=i.data.map((o,m)=>{let l;return n===0||!a?(l=ve(o,s.granularity,t),r[m]=l):l=r[m],{...l,value:o.value}});return{...i,data:c}})}}function ve(s,t,a){return s.label!=null?{label:s.label}:s.date?Ne(s,t,a):{label:""}}function Ne({date:s,endDate:t,value:a},r="day",i){const n=k(s).toDate(),c=t?k(t).toDate():null;switch(r){case"minute":return{label:u(i,{second:"2-digit"}).format(n),tooltipTitle:u(i,{day:"2-digit",hour:"numeric",minute:"numeric",second:"2-digit"}).format(n)};case"hour":return{label:u(i,{hour:"numeric",minute:"numeric"}).format(n),tooltipTitle:u(i,{month:"short",day:"2-digit",hour:"numeric",minute:"numeric"}).format(n)};case"day":return{label:u(i,{day:"2-digit",weekday:"short"}).format(n),tooltipTitle:u(i,{day:"2-digit",weekday:"short",month:"short"}).format(n)};case"week":return{label:u(i,{month:"short",day:"2-digit"}).format(n),tooltipTitle:u(i,{day:"2-digit",month:"long",year:"numeric"}).formatRange(n,c)};case"month":return{label:u(i,{month:"short",year:"numeric"}).format(n),tooltipTitle:u(i,{month:"long",year:"numeric"}).format(n)};case"year":return{label:u(i,{year:"numeric"}).format(n),tooltipTitle:u(i,{year:"numeric"}).format(n)}}}const u=q((s,t)=>new Q(s,t),{equals:(s,t)=>Z(s,t),callTimeout:void 0}),R=J().themes.all[0].colors["--be-primary"],g=[[`rgb(${R.replaceAll(" ",",")})`,`rgba(${R.replaceAll(" ",",")},0.2)`],["rgb(255,112,67)","rgb(255,112,67,0.2)"],["rgb(255,167,38)","rgb(255,167,38,0.2)"],["rgb(141,110,99)","rgb(141,110,99,0.2)"],["rgb(102,187,106)","rgba(102,187,106,0.2)"],["rgb(92,107,192)","rgb(92,107,192,0.2)"]],we={parsing:{xAxisKey:"label",yAxisKey:"value"},datasets:{line:{fill:"origin",tension:.1,pointBorderWidth:4,pointHitRadius:10}},plugins:{tooltip:{intersect:!1,mode:"index"}}};function ye({data:s,className:t,...a}){const{localeCode:r}=b(),i=d.useMemo(()=>{const n=y(s,{localeCode:r});return n.datasets=n.datasets.map((c,o)=>({...c,backgroundColor:g[o][1],borderColor:g[o][0],pointBackgroundColor:g[o][0]})),n},[s,r]);return e.jsx(w,{...a,className:p(t,"min-w-500"),data:i,type:"line",options:we})}const De={parsing:{key:"value"},plugins:{tooltip:{intersect:!0}}};function Ce({data:s,className:t,...a}){const{localeCode:r}=b(),i=d.useMemo(()=>{var c;const n=y(s,{localeCode:r});return n.labels=(c=n.datasets[0])==null?void 0:c.data.map(o=>o.label),n.datasets=n.datasets.map((o,m)=>({...o,backgroundColor:g.map(l=>l[1]),borderColor:g.map(l=>l[0]),borderWidth:2})),n},[s,r]);return e.jsx(w,{type:"polarArea",data:i,options:De,className:p(t,"min-w-500"),...a})}function Te({data:s,direction:t="vertical",individualBarColors:a=!1,className:r,...i}){const{localeCode:n}=b(),c=d.useMemo(()=>{const l=y(s,{localeCode:n});return l.datasets=l.datasets.map((h,j)=>({...h,backgroundColor:a?g.map(f=>f[1]):g[j][1],borderColor:a?g.map(f=>f[0]):g[j][0],borderWidth:2})),l},[s,n,a]),o=t==="horizontal",m=d.useMemo(()=>({indexAxis:o?"y":"x",parsing:{xAxisKey:o?"value":"label",yAxisKey:o?"label":"value"}}),[o]);return e.jsx(w,{type:"bar",className:p(r,"min-w-500"),data:c,options:m,...i})}const A="https://www.gstatic.com/charts/loader.js";function ke({placeholderRef:s,data:t,country:a,onCountrySelected:r}){const{trans:i}=X(),{analytics:n}=Y(),c=n==null?void 0:n.gchart_api_key,{selectedTheme:o}=S(),m=d.useRef(),l=!!r&&!a,h=d.useCallback(()=>{var D,C;if(typeof google>"u")return;const f=t.map(T=>[T.label,T.value]);f.unshift([i(a?v("City"):v("Country")),i(v("Clicks"))]);const _=`${z(o.colors["--be-paper"])}`,E={colorAxis:{colors:[`${z(o.colors["--be-primary"])}`]},backgroundColor:_,region:a?a.toUpperCase():void 0,resolution:a?"provinces":"countries",displayMode:a?"markers":"regions",enableRegionInteractivity:l};!m.current&&s.current&&((D=google==null?void 0:google.visualization)!=null&&D.GeoChart)&&(m.current=new google.visualization.GeoChart(s.current)),(C=m.current)==null||C.draw(google.visualization.arrayToDataTable(f),E)},[o,t,s,i,a,l]),j=d.useCallback(async()=>{I.isLoadingOrLoaded(A)||(await I.loadAsset(A,{type:"js"}),await google.charts.load("current",{packages:["geochart"],mapsApiKey:c}),h())},[c,h]);return d.useEffect(()=>(m.current&&r&&google.visualization.events.addListener(m.current,"regionClick",f=>r==null?void 0:r(f.region)),()=>{m.current&&google.visualization.events.removeAllListeners(m.current)}),[r,m.current]),d.useEffect(()=>{j()},[j]),d.useEffect(()=>{h()},[o,h,t]),{drawGoogleChart:h}}const Ie=ee(e.jsx("path",{d:"M9 8a1 1 0 0 0-1-1H5.5a1 1 0 1 0 0 2H7v4a1 1 0 0 0 2 0zM4 0h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H4a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4zm4 5.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),"InfoDialogTrigger");function ze({title:s,body:t,dialogSize:a="sm",className:r}){return e.jsxs(L,{type:"popover",triggerOnHover:!0,children:[e.jsx(se,{className:p("text-muted opacity-70",r),size:"xs",children:e.jsx(Ie,{viewBox:"0 0 16 16"})}),e.jsxs(te,{size:a,children:[s&&e.jsx(ae,{padding:"px-18 pt-12",size:"md",hideDismissButton:!0,children:s}),e.jsx(re,{children:t})]})]})}const Re=d.memo(({code:s})=>{const{localeCode:t}=b(),a=new Intl.DisplayNames([t],{type:"region"});let r;try{r=a.of(s.toUpperCase())}catch{}return e.jsx(d.Fragment,{children:r})});function Ae({data:s,isLoading:t,onCountrySelected:a,country:r,...i}){const n=d.useRef(null),c=!!a,o=s==null?void 0:s.datasets[0].data,m=d.useMemo(()=>o||[],[o]);return ke({placeholderRef:n,data:m,country:r,onCountrySelected:a}),e.jsxs(H,{...i,className:"min-w-500",title:e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{message:"Top Locations"}),r?e.jsxs("span",{className:"pl-4",children:["(",e.jsx(Re,{code:r}),")"]}):null,c&&e.jsx(Fe,{})]}),contentIsFlex:t,children:[t&&e.jsx(N,{}),e.jsxs("div",{className:"flex gap-24",children:[e.jsx("div",{ref:n,className:"flex-auto w-[480px] min-h-[340px]"}),e.jsxs("div",{className:"w-[170px]",children:[e.jsx("div",{className:"text-sm max-h-[340px] w-full flex-initial overflow-y-auto",children:m.map(l=>e.jsxs("div",{className:p("flex items-center gap-4 mb-4",c&&"cursor-pointer hover:underline"),role:c?"button":void 0,onClick:()=>{a==null||a(l.code)},children:[e.jsx("div",{className:"max-w-110 whitespace-nowrap overflow-hidden overflow-ellipsis",children:l.label}),e.jsxs("div",{children:["(",l.percentage,")%"]})]},l.label))}),r&&e.jsx(P,{variant:"outline",size:"xs",className:"mt-14",startIcon:e.jsx(de,{}),onClick:()=>{a==null||a(void 0)},children:e.jsx(x,{message:"Back to countries"})})]})]})]})}function Fe(){return e.jsx(ze,{title:e.jsx(x,{message:"Zooming in"}),body:e.jsx(x,{message:"Click on a country inside the map or country list to zoom in and see city data for that country."})})}const G="gap-12 md:gap-24 mb-12 md:mb-24",F=`flex flex-col md:flex-row md:items-center overflow-x-auto ${G}`;function Le({report:s,isLoading:t}){const a=s==null?void 0:s.pageViews.total;return e.jsxs(d.Fragment,{children:[e.jsxs("div",{className:F,children:[e.jsx(ye,{isLoading:t,className:"flex-auto",data:s==null?void 0:s.pageViews,title:e.jsx(x,{message:"Pageviews"}),description:a?e.jsx(x,{message:":count total views",values:{count:e.jsx(M,{value:a})}}):null}),e.jsx(Ce,{isLoading:t,data:s==null?void 0:s.devices,title:e.jsx(x,{message:"Top devices"})})]}),e.jsxs("div",{className:F,children:[e.jsx(Te,{isLoading:t,data:s==null?void 0:s.browsers,className:"flex-auto md:w-1/3",direction:"horizontal",individualBarColors:!0,hideLegend:!0,title:e.jsx(x,{message:"Top browsers"})}),e.jsx(Ae,{isLoading:t,className:"flex-auto",data:s==null?void 0:s.locations,title:e.jsx(x,{message:"Top locations"})})]})]})}function Pe({report:s,dateRange:t}){return V,t.start,t.end,e.jsx("div",{className:`flex items-center flex-shrink-0 overflow-x-auto h-[97px] ${G}`,children:s==null?void 0:s.map(a=>e.jsx(Be,{datum:a},a.name))})}function Be({datum:s,label:t}){const a=ie(s.icon);return e.jsxs("div",{className:"flex items-center flex-auto rounded border p-20 gap-18 h-full whitespace-nowrap",children:[e.jsx("div",{className:"bg-primary-light/20 rounded-lg p-10 flex-shrink-0",children:e.jsx(a,{size:"lg",className:"text-primary"})}),e.jsxs("div",{className:"flex-auto",children:[e.jsxs("div",{className:"flex items-center gap-20 justify-between",children:[e.jsx("div",{className:"text-main text-lg font-bold",children:s.type==="fileSize"?e.jsx(he,{bytes:s.currentValue}):e.jsx(M,{value:s.currentValue})}),t&&e.jsx("div",{className:"text-xs text-muted ml-auto",children:t})]}),e.jsxs("div",{className:"flex items-center gap-20 justify-between",children:[e.jsx("h2",{className:"text-muted text-sm",children:s.name}),s.percentageChange!=null&&e.jsx("div",{className:"flex items-center gap-10",children:e.jsx(Me,{percentage:s.percentageChange})})]})]})]},s.name)}function Me({percentage:s}){let t;return s>0?t=e.jsx(le,{size:"md",className:"text-positive"}):s===0?t=e.jsx(ce,{className:"text-muted"}):t=e.jsx(me,{className:"text-danger"}),e.jsxs(d.Fragment,{children:[t,e.jsxs("div",{className:"text-sm font-semibold text-muted",children:[s,"%"]})]})}const Ve={month:"short",day:"2-digit"};function $e({value:s,onChange:t,compactOnMobile:a=!0}){const r=B();return e.jsxs(L,{type:"popover",onClose:i=>{i&&t(i)},children:[e.jsx(P,{variant:"outline",color:"chip",endIcon:e.jsx(ue,{}),children:e.jsx(V,{start:s.start,end:s.end,options:r&&a?Ve:ne.short})}),e.jsx(He,{value:s})]})}function He({value:s}){const t=B(),a=xe({defaultValue:s,closeDialogOnSelection:!1});return e.jsx(ge,{state:a,showInlineDatePickerField:!t})}function qe(){const[s,t]=d.useState(()=>fe[2].getRangeValue()),{isLoading:a,data:r}=pe({dateRange:s}),i=e.jsx(x,{message:"Visitors report"});return e.jsxs("div",{className:"min-h-full gap-12 md:gap-24 p-12 md:p-24 overflow-x-hidden",children:[e.jsxs("div",{className:"md:flex items-center justify-between gap-24 mb-24",children:[e.jsx(oe,{children:i}),e.jsx("h1",{className:"mb-24 md:mb-0 text-3xl font-light",children:i}),e.jsx($e,{value:s,onChange:t})]}),e.jsx(Pe,{report:r==null?void 0:r.headerReport,dateRange:s}),e.jsx(Le,{report:r==null?void 0:r.visitorsReport,isLoading:a})]})}export{qe as default};
//# sourceMappingURL=admin-report-page-2bb6a3e0.js.map
