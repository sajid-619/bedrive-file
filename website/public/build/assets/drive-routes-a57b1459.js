import{bg as bn,bh as As,bi as yn,bj as wn,bk as Sn,bl as kn,G as C,aq as Zs,ar as Js,bm as $e,bn as ts,aB as rs,bo as as,bp as et,b as E,E as F,J as T,m as f,H as N,bq as W,j as s,aL as ie,f as M,K as st,aM as oe,I as L,T as d,r as h,a0 as ae,B as P,d as tt,br as In,a$ as Se,t as B,N as ke,bs as En,v as qe,R as Dn,c as D,bt as Pn,bu as Nn,a as le,aT as xe,bv as X,bw as K,u as He,bx as Ls,by as Oe,aS as Fn,_ as Be,q as nt,ay as Cn,as as rt,ax as pe,bz as is,A as Q,k as $,x as os,s as ce,an as Rs,aw as at,M as Ye,bf as it,bA as Mn,bB as V,U as Ie,p as Ee,l as q,D as Z,n as J,o as Y,F as De,V as Pe,Q as ve,bC as ls,L as je,af as ot,bD as lt,Y as be,bE as cs,bF as An,a9 as ct,X as Ln,b2 as Ts,i as Rn,a7 as Ue,$ as _s,h as Tn,aC as ee,a4 as Ge,bG as _n,C as zn,W as dt,bH as Xe,bI as $n,w as Ze,bJ as On,bK as Bn,bL as ut,at as ze,bM as Un,b7 as Wn,bN as Vn,aI as Kn,bO as Qn,bP as qn,bQ as Hn,bR as Yn,ah as Gn,ai as Xn,z as Zn,bd as Jn,be as ne}from"./main-97137759.js";import{V as mt,k as We,l as Ve,W as ds,L as er,x as us,X as ms,M as fs,T as ft,J as ht,D as xt,a as pt,c as gt,Y as sr,Z as vt,y as hs,Q as tr,j as jt,t as Je,s as bt,_ as nr,F as Re,d as Te,e as rr,u as ar,$ as se,i as ir,w as yt,p as wt,v as zs,a0 as or,a1 as lr,a2 as cr,E as dr,A as xs,G as ur,U as mr,q as ps,n as $s,m as fr,R as hr,a3 as Os,b as Bs}from"./UnfoldMore-d3e3f3ab.js";import{I as xr,R as pr,P as St,S as gr,a as vr,D as jr,b as br,C as yr,c as wr,d as gs,F as kt,e as It,f as Sr,g as kr,G as Ir,h as Er,i as Dr,A as Pr,B as Nr,j as vs,U as Fr,k as Cr,V as Mr,l as Ar,m as Lr}from"./Info-42a59bef.js";import{B as js,a as Ke,E as Rr,C as Tr}from"./Edit-fdaf8b96.js";class _r extends bn{constructor(t,n){super(t,n)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t,n){super.setOptions({...t,behavior:As()},n)}getOptimisticResult(t){return t.behavior=As(),super.getOptimisticResult(t)}fetchNextPage({pageParam:t,...n}={}){return this.fetch({...n,meta:{fetchMore:{direction:"forward",pageParam:t}}})}fetchPreviousPage({pageParam:t,...n}={}){return this.fetch({...n,meta:{fetchMore:{direction:"backward",pageParam:t}}})}createResult(t,n){var r,a,i,o,l,c;const{state:u}=t,x=super.createResult(t,n),{isFetching:m,isRefetching:g}=x,v=m&&((r=u.fetchMeta)==null||(a=r.fetchMore)==null?void 0:a.direction)==="forward",y=m&&((i=u.fetchMeta)==null||(o=i.fetchMore)==null?void 0:o.direction)==="backward";return{...x,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:yn(n,(l=u.data)==null?void 0:l.pages),hasPreviousPage:wn(n,(c=u.data)==null?void 0:c.pages),isFetchingNextPage:v,isFetchingPreviousPage:y,isRefetching:g&&!v&&!y}}}function Et(e,t,n){const r=Sn(e,t,n);return kn(r,_r)}const R={fetchEntries:e=>{const t=["drive-entries"];return e&&t.push(e),t},fetchUserFolders(e){const t=["user-folders"];return e&&t.push(e),t},fetchShareableLink:e=>{const t=["shareable-link"];return e&&t.push(e),t},fetchFolderPath(e,t){const n=["folder-path"];return e&&n.push(e),t&&n.push(t),n},fetchEntryShareableLink:e=>["file-entries",e,"shareable-link"],fetchFileEntry:e=>{const t=["drive/file-entries/model"];return e&&t.push(e),t},fetchStorageSummary:["storage-summary"]};function O(){return Promise.all([C.invalidateQueries(R.fetchEntries()),C.invalidateQueries(R.fetchFolderPath()),C.invalidateQueries(R.fetchUserFolders()),C.invalidateQueries(R.fetchFileEntry())])}const U=Zs()(Js(e=>({password:null,viewMode:$e("drive.viewMode"),activeSort:{orderBy:"updated_at",orderDir:"desc"},setPassword:t=>{e(n=>{n.password=t})},isPasswordProtected:!1,setIsPasswordProtected:t=>{e(n=>{n.isPasswordProtected=t})},setViewMode:t=>{e(n=>{n.viewMode=t,ts("drive.viewMode",t)})},setActiveSort:t=>{e(n=>{n.activeSort=t})}})));function fe(){return U.getState()}function zr({hash:e,page:t=1,order:n,password:r}){return E.get(`shareable-links/${e}`,{params:{loader:"shareableLinkPage",page:t,order:n,password:r}}).then(a=>a.data)}function te(){var l,c;const{hash:e}=rs(),{orderBy:t,orderDir:n}=U(u=>u.activeSort),r=`${t}:${n}`,a=U(u=>u.isPasswordProtected),i=U(u=>u.password),o=Et(R.fetchShareableLink({hash:e,sort:r}),({pageParam:u=1})=>zr({hash:e,page:u,order:r,password:i}),{initialData:()=>{var x;const u=(x=as().loaders)==null?void 0:x.shareableLinkPage;if(u)return{pageParams:[void 0,1],pages:[u]}},getNextPageParam:u=>{if(!u.folderChildren)return;const x=u.folderChildren.current_page,m=u.folderChildren.last_page;if(!(x>=m))return x+1},enabled:!!e&&!a||i!=null,keepPreviousData:!0,retry:(u,x)=>Us(x)?!1:u<=2,onError:u=>{if(Us(u))return fe().setIsPasswordProtected(!0)}});return{...o,link:(l=o.data)==null?void 0:l.pages[0].link,entries:(c=o.data)==null?void 0:c.pages.flatMap(u=>{var x;return(x=u.folderChildren)==null?void 0:x.data})}}function Us(e){var t,n;return et.isAxiosError(e)&&((n=(t=e.response)==null?void 0:t.data)==null?void 0:n.passwordInvalid)}function $r({password:e,linkHash:t}){return E.post(`shareable-links/${t}/check-password`,{password:e}).then(n=>n.data)}function Or(){return F(e=>$r(e),{onSuccess:(e,t)=>{e.matches&&fe().setPassword(t.password)},onError:e=>T(e,f("Could not create link"))})}function Br({linkId:e,password:t}){return E.post(`shareable-links/${e}/import`,{password:t}).then(n=>n.data)}function Ur(){const e=U(t=>t.password);return F(t=>Br({...t,password:e}),{onSuccess:async()=>{await C.invalidateQueries(R.fetchShareableLink()),N(f("Item imported into your drive"))},onError:t=>T(t,f("Could not create link"))})}function Dt(){var o;const{link:e}=te(),{user:t,isLoggedIn:n}=W(),{downloadUrl:r}=mt(e==null?void 0:e.entry),a=Ur(),i=(o=e==null?void 0:e.entry)==null?void 0:o.users.find(l=>l.id===(t==null?void 0:t.id));return e!=null&&e.entry?s.jsxs("div",{children:[e.allow_download&&s.jsx(Wr,{downloadUrl:r}),!i&&n&&e.allow_edit&&s.jsxs(ie,{onItemSelected:l=>{l==="import"?a.mutate({linkId:e.id}):l==="download"&&r&&We(r)},children:[s.jsx(M,{className:"ml-6",disabled:a.isLoading,children:s.jsx(st,{})}),s.jsxs(oe,{children:[s.jsx(L,{value:"download",startIcon:s.jsx(Ve,{}),children:s.jsx(d,{message:"Download"})}),s.jsx(L,{value:"import",startIcon:s.jsx(xr,{}),children:s.jsx(d,{message:"Save a copy to your own drive"})})]})]})]}):null}function Wr({downloadUrl:e}){return s.jsxs(h.Fragment,{children:[s.jsx(ae,{label:s.jsx(d,{message:"Download"}),children:s.jsx(M,{className:"md:hidden",onClick:()=>{e&&We(e)},children:s.jsx(Ve,{})})}),s.jsx(P,{className:"max-md:hidden",size:"sm",variant:"flat",color:"chip",startIcon:s.jsx(Ve,{}),onClick:()=>{e&&We(e)},children:s.jsx(d,{message:"Download"})})]})}function Pt(){const{link:e}=te(),t=tt();return s.jsx(In,{size:"md",color:"bg",className:"flex-shrink-0",rightChildren:(e==null?void 0:e.entry)&&s.jsx(Dt,{}),menuPosition:"shareable-link-page",hideLogo:t,children:(e==null?void 0:e.entry)&&e.entry.type!=="folder"&&s.jsxs("div",{className:"flex items-center gap-10",children:[s.jsx(Se,{className:"flex-shrink-0",type:e.entry.type}),s.jsx("div",{className:"font-medium whitespace-nowrap overflow-hidden overflow-ellipsis flex-auto",children:e.entry.name})]})})}function Vr(){const{trans:e}=B(),{hash:t}=rs(),n=e({message:"Password"}),[r,a]=h.useState(""),i=Or(),o=t?t.split(":")[0]:null,l=i.data&&!i.data.matches;return s.jsxs("div",{className:"bg-alt h-screen flex flex-col",children:[s.jsx(Pt,{}),s.jsx("div",{className:"px-10 md:px-20 mx-auto my-80",children:s.jsxs("div",{className:"flex flex-col md:flex-row gap-40 md:gap-14 bg items-center max-w-[560px] border rounded p-24",children:[s.jsx("div",{className:"h-132",children:s.jsx(ke,{src:En})}),s.jsxs("form",{onSubmit:c=>{c.preventDefault(),i.mutate({linkHash:o,password:r})},children:[s.jsx("span",{className:"text-sm",children:s.jsx(d,{message:"The link you are trying to access is password protected."})}),s.jsx(qe,{autoFocus:!0,placeholder:n,"aria-label":n,className:"mt-10 mb-20",type:"password",value:r,required:!0,errorMessage:l&&s.jsx(d,{message:"Password is not valid"}),onChange:c=>{a(c.target.value)}}),s.jsx("div",{className:"text-right",children:s.jsx(P,{variant:"flat",color:"primary",type:"submit",className:"w-full md:w-auto",disabled:i.isLoading,children:s.jsx(d,{message:"Enter"})})})]})]})})]})}const Nt=Dn.forwardRef(({entry:e,className:t,isSelected:n,isMobileMode:r,footerAdornment:a,...i},o)=>s.jsxs("div",{...i,ref:o,className:D("shadow rounded border aspect-square flex flex-col grid-item transition-shadow-opacity select-none overflow-hidden outline-none dark:bg-alt",n&&"border-primary",t),children:[s.jsx("div",{className:"flex-auto relative min-h-0",children:s.jsx(ds,{className:"h-full w-full",iconClassName:"block w-70 h-70 absolute m-auto inset-0",file:e})}),s.jsx(Kr,{entry:e,isSelected:n,isMobile:r,adornment:a})]}));function Kr({entry:e,isSelected:t,isMobile:n,adornment:r}){return s.jsxs("div",{className:D("text-sm h-48 flex-shrink-0 flex items-center",n?"justify-between gap-10 pl-18 pr-2":"justify-center px-16",t&&"bg-primary-light/20"),children:[s.jsx("div",{className:"min-w-0 whitespace-nowrap overflow-hidden overflow-ellipsis",children:e.name}),r]})}function Qr({entries:e,onEntrySelected:t}){return s.jsx("div",{className:"file-grid",children:e.map((n,r)=>s.jsx(Nt,{tabIndex:-1,className:"hover:shadow-md cursor-pointer bg",entry:n,onContextMenu:a=>{a.preventDefault()},onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&t(n,r)},onClick:()=>{t(n,r)}},n.id))})}const qr=[];Pn();var Gs,Xs;const Ws={uploadQueueIsOpen:!1,contextMenuData:null,selectedEntries:new Set,entriesBeingDragged:[],activeActionDialog:null,sidebarExpandedKeys:[],viewMode:$e("drive.viewMode",((Xs=(Gs=as().settings)==null?void 0:Gs.drive)==null?void 0:Xs.default_view)||"grid"),sortDescriptor:{orderBy:"updated_at",orderDir:"desc"}},w=Zs()(Js((e,t)=>({...Ws,setUploadQueueIsOpen:n=>{e(r=>{r.uploadQueueIsOpen=n})},setContextMenuData:n=>{e(r=>{r.contextMenuData=n})},setSortDescriptor:n=>{e(r=>{var i;const a=(i=t().activePage)==null?void 0:i.id;a&&ts("selectedSorting",{...$e("selectedSorting"),[a]:n}),r.sortDescriptor=n})},setActivePage:n=>{e(r=>{var i;r.activePage=n;const a=(i=$e("selectedSorting"))==null?void 0:i[n.id];r.sortDescriptor=a||n.sortDescriptor})},setEntriesBeingDragged:n=>{e(r=>{r.entriesBeingDragged=n})},setActiveActionDialog:(n,r=qr)=>{e(a=>{const i=t().activeActionDialog;((i==null?void 0:i.name)!==n||i.entries!==r)&&(a.activeActionDialog=n?{name:n,entries:r}:null)})},setViewMode:n=>{e(r=>{r.viewMode=n,ts("drive.viewMode",n)})},setSidebarExpandedKeys:n=>e(r=>{r.sidebarExpandedKeys=n}),expandSidebarItem:n=>e(r=>{r.sidebarExpandedKeys.includes(n)||r.sidebarExpandedKeys.push(n)}),collapseSidebarItem:n=>e(r=>{const a=r.sidebarExpandedKeys.indexOf(n);a>-1&&r.sidebarExpandedKeys.splice(a,1)}),toggleSidebarItem:n=>e(r=>{r.sidebarExpandedKeys.includes(n)?r.expandSidebarItem(n):r.collapseSidebarItem(n)}),selectEntries:(n,r)=>{e(a=>{r||a.selectedEntries.clear(),n.forEach(i=>i&&a.selectedEntries.add(i))})},deselectEntries:n=>{e(r=>{r.selectedEntries.size&&(n==="all"?r.selectedEntries=new Set:n.forEach(a=>r.selectedEntries.delete(a)))})},reset:()=>{e(Ws)}})));function p(){return w.getState()}function Hr(){const e=w(t=>t.activeActionDialog);return e==null?void 0:e.entries[0]}function Yr(e){return e?E.post(`file-entries/${e}/shareable-link`).then(t=>t.data):Promise.reject(new Error("Invalid entry id"))}function Ft(){return F(({entryId:e})=>Yr(e),{onSuccess:(e,{entryId:t})=>{C.setQueryData(R.fetchEntryShareableLink(t),e)},onError:e=>T(e,f("Could not create link"))})}function Gr({entryIds:e}){return E.post("file-entries/star",{entryIds:e}).then(t=>t.data)}function Xr(){return F(e=>Gr(e),{onSuccess:(e,{entryIds:t})=>{O(),N(f("Starred [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>T(e,f("Could not star items"))})}function Zr({entryIds:e}){return E.post("file-entries/unstar",{entryIds:e}).then(t=>t.data)}function Jr(){return F(e=>Zr(e),{onSuccess:(e,{entryIds:t})=>{O(),N(f("Removed star from [one 1 item|other :count items]",{values:{count:t.length}}))},onError:e=>T(e,f("Could not remove star"))})}function ea(e){return E.post("file-entries/duplicate",e).then(t=>t.data)}function sa(){return F(e=>(N.loading(f("Duplicating [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),ea(e)),{onSuccess:(e,t)=>{O(),C.invalidateQueries(R.fetchStorageSummary),N(f("Duplicated [one 1 item|other :count items]",{values:{count:t.entryIds.length}}),{disableEnterAnimation:!0})},onError:e=>T(e,f("Could not duplicate items"),null,{disableEnterAnimation:!0})})}const ta=""+new URL("add-files-107c40dd.svg",import.meta.url).href,na=""+new URL("time-management-5219b76e.svg",import.meta.url).href,Vs=""+new URL("file-searching-49556098.svg",import.meta.url).href,ra=""+new URL("throw-away-389510cc.svg",import.meta.url).href,aa=""+new URL("loving-it-585c130e.svg",import.meta.url).href,Ct=""+new URL("share-70babf29.svg",import.meta.url).href,Ne={orderBy:"updated_at",orderDir:"desc"};function bs(e){return{...Mt(e.hash),canUpload:e.permissions["files.create"]||e.permissions["files.update"],label:e.name,folder:e}}function Mt(e){return{id:e,label:"",path:es(e),hasActions:!0,canUpload:!1,sortDescriptor:Ne,isFolderPage:!0,noContentMessage:()=>({title:f("Drop files or folders here"),description:f('Or use the "Upload" button'),image:ta})}}function es(e){return e==="0"?"/drive":`/drive/folders/${e}`}const ia=as().rootFolder,_=bs(ia),oa={id:"recent",label:f("Recent"),path:"/drive/recent",disableSort:!0,sortDescriptor:{orderBy:"created_at",orderDir:"desc"},queryParams:{recentOnly:!0},noContentMessage:()=>({title:f("No recent entries"),description:f("You have not uploaded any files or folders yet"),image:na})},H={id:"search",label:f("Search results"),path:"/drive/search",sortDescriptor:Ne,noContentMessage:e=>e?{title:f("No matching results"),description:f("Try changing your search query or filters"),image:Vs}:{title:f("Begin typing or select a filter to search"),description:f("Search for files, folders and other content"),image:Vs}},ge={id:"shares",label:f("Shared"),path:"/drive/shares",sortDescriptor:Ne,queryParams:{sharedOnly:!0},noContentMessage:()=>({title:f("Shared with me"),description:f("Files and folders other people have shared with you"),image:Ct})},A={id:"trash",label:f("Trash"),path:"/drive/trash",sortDescriptor:Ne,hasActions:!0,queryParams:{deletedOnly:!0},noContentMessage:()=>({title:f("Trash is empty"),description:f("There are no files or folders in your trash currently"),image:ra})},la={id:"starred",label:f("Starred"),path:"/drive/starred",sortDescriptor:Ne,queryParams:{starredOnly:!0},noContentMessage:()=>({title:f("Nothing is starred"),description:f("Add stars to files and folders that you want to easily find later"),image:aa})},ca=[_,oa,H,ge,A,la];function da(e){return E.post("file-entries/delete",e).then(t=>t.data)}function Fe(){return F(e=>(N.loading(ua(e),{disableExitAnimation:!0}),da(e)),{onSuccess:(e,{entryIds:t,emptyTrash:n,deleteForever:r})=>{O(),C.invalidateQueries(R.fetchStorageSummary),n?N(f("Emptied trash"),{disableEnterAnimation:!0}):r?N(f("Permanently deleted [one 1 item|other :count items]",{values:{count:t.length}}),{disableEnterAnimation:!0}):N(f("Moved [one 1 item|other :count items] to trash",{values:{count:t.length}}),{disableEnterAnimation:!0})},onError:(e,{emptyTrash:t})=>{const n=Nn(e);n?N.danger(n,{disableEnterAnimation:!0}):t?N.danger("could not empty trash",{disableEnterAnimation:!0}):N.danger("Could not delete items",{disableEnterAnimation:!0})}})}function ua(e){return e.emptyTrash?f("Emptying trash..."):e.deleteForever?f("Deleting files..."):f("Moving to trash...")}function At(){return F(e=>ma(e),{onSuccess:()=>O()})}function ma({entryIds:e,...t}){return E.post(`file-entries/${e.join(",")}/unshare`,t).then(n=>n.data)}function Lt(){return F(e=>fa(e),{onSuccess:(e,t)=>{O(),N(f("Restored [one 1 item|other :count items]",{values:{count:t.entryIds.length}}))},onError:e=>T(e,f("Could not restore items"))})}function fa(e){return E.post("file-entries/restore",e).then(t=>t.data)}function Rt(e){const t=Tt(e),n=ys(e),r=ha(e),a=xa(e),i=pa(e),o=ga(e),l=va(e),c=ja(e),u=ba(e),x=_t(e),m=zt(e),g=ya(e);return[t,n,r,a,i,o,l,c,u,x,m,g].filter(v=>!!v)}function Tt(e){if(e.some(t=>t.type!=="folder"))return{label:f("Preview"),icon:pr,key:"preview",execute:()=>{p().setActiveActionDialog("preview",e)}}}function ys(e){const t=w(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===A))return{label:f("Share"),icon:St,key:"share",execute:()=>{p().setActiveActionDialog("share",e)}}}function ha(e){const t=w(r=>r.activePage),n=Ft();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===A))return{label:f("Get link"),icon:er,key:"getLink",execute:()=>{n.mutate({entryId:e[0].id}),p().setActiveActionDialog("getLink",e)}}}function xa(e){const t=w(r=>r.activePage),n=Xr();if(!(e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||!e.every(r=>r.permissions["files.update"])||t===A))return{label:f("Add to starred"),icon:gr,key:"addToStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function pa(e){const t=w(r=>r.activePage),n=Jr();if(!(!e.every(r=>{var a;return(a=r.tags)==null?void 0:a.find(i=>i.name==="starred")})||t===A))return{label:f("Remove from starred"),icon:vr,key:"removeFromStarred",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function ga(e){const t=w(n=>n.activePage);if(!(!e.every(n=>n.permissions["files.update"])||t===ge||t===A))return{label:f("Move to"),icon:jr,key:"moveTo",execute:()=>{p().setActiveActionDialog("moveTo",e)}}}function va(e){const t=w(n=>n.activePage);if(!(e.length>1||!e.every(n=>n.permissions["files.update"])||t===A))return{label:f("Rename"),icon:br,key:"rename",execute:()=>{p().setActiveActionDialog("rename",e)}}}function ja(e){const t=w(r=>r.activePage),n=sa();if(!(e.length>1||!e.every(r=>r.permissions["files.update"])||t===A))return{label:f("Make a copy"),icon:yr,key:"makeCopy",execute:()=>{n.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function ba(e){const{downloadUrl:t}=mt(e[0],{downloadHashes:e.map(n=>n.hash)});if(e.every(n=>n.permissions["files.download"]))return{label:f("Download"),icon:Ve,key:"download",execute:()=>{t&&We(t),p().selectEntries([])}}}function _t(e){const t=Fe(),n=w(r=>r.activePage);if(!(n===ge||!e.every(r=>r.permissions["files.delete"])))return{label:n===A?f("Delete forever"):f("Remove"),icon:us,key:"delete",execute:()=>{n===A?p().setActiveActionDialog("confirmAndDeleteForever",e):(t.mutate({entryIds:e.map(r=>r.id),deleteForever:n===A}),p().selectEntries([]))}}}function ya(e){const t=Lt();if(!(w(r=>r.activePage)!==A||!e.every(r=>r.permissions["files.delete"])))return{label:f("Restore"),icon:wr,key:"restore",execute:()=>{t.mutate({entryIds:e.map(r=>r.id)}),p().selectEntries([])}}}function zt(e){const t=At();if(w(r=>r.activePage)===ge)return{label:f("Remove"),icon:us,key:"removeSharedEntry",execute:()=>{t.mutate({entryIds:e.map(r=>r.id),userId:"me"},{onSuccess:(r,a)=>{N(f("Removed [one 1 item|other {count} items]",{values:{count:a.entryIds.length}}))},onError:r=>T(r,f("Could not remove items"))}),p().selectEntries([])}}}function $t(){return le(R.fetchStorageSummary,wa,{select:Sa})}function wa(){return E.get("user/space-usage").then(e=>e.data)}function Sa(e){const t=e.available===null?0:e.used*100/e.available;return{usedFormatted:xe(e.used),availableFormatted:xe(e.available),percentage:t,used:e.used,available:e.available}}const ka=8388608;function Ce(){var x;const e=X(m=>m.uploadMultiple),t=w(m=>m.activePage),{data:n}=$t(),{workspaceId:r}=K(),a=((x=t==null?void 0:t.folder)==null?void 0:x.id)||null,{uploads:i}=He(),o=i.max_size||ka,l=i.allowed_extensions,c=i.blocked_extensions;return{uploadFiles:h.useCallback((m,g={})=>{if(g.metadata||(g.metadata={}),g.metadata.workspaceId=r,g.metadata.parentId||(g.metadata.parentId=a),m=[...m].map(v=>v instanceof Ls?v:new Ls(v)),n){const v=m.reduce((b,S)=>b+S.size,0),y=n.used,j=n.available;if(v+y>j){N.danger(f("You have exhausted your allowed space of :space. Delete some files or upgrade your plan.",{values:{space:n.availableFormatted}}),{action:{action:"/pricing",label:f("Upgrade")}});return}}e(m,{...g,restrictions:{maxFileSize:o,allowedFileTypes:l,blockedFileTypes:c},onSuccess:(v,y)=>{var j;(j=g==null?void 0:g.onSuccess)==null||j.call(g,v,y),O(),C.invalidateQueries(R.fetchStorageSummary)}}),p().setUploadQueueIsOpen(!0)},[e,a,r,l,c,o,n])}}function Ot(e){const t=Ia(e),n=Ea(e),r=Da(e),a=Pa();return[t,n,r,a].filter(i=>!!i)}function Ia(e){if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:f("New folder"),icon:gs,key:"newFolder",execute:()=>{e.folder&&p().setActiveActionDialog("newFolder",[e.folder])}}}function Ea(e){const{uploadFiles:t}=Ce();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:f("Upload files"),icon:kt,key:"uploadFiles",execute:async()=>{t(await Oe({multiple:!0}))}}}function Da(e){const{uploadFiles:t}=Ce();if(!(!e.folder||!e.folder.permissions["files.update"]))return{label:f("Upload folder"),icon:It,key:"uploadFolder",execute:async()=>{t(await Oe({directory:!0}))}}}function Pa(e){const t=Fe();if(w(r=>r.activePage)===A)return{label:f("Empty trash"),icon:Sr,key:"emptyTrash",execute:()=>{t.mutate({entryIds:[],emptyTrash:!0}),p().selectEntries([])}}}function ss({children:e,entries:t,page:n}){return(n==null?void 0:n.id)===_.id?s.jsx(Qs,{page:_,children:e}):n===A?s.jsx(Qs,{page:A,children:e}):n!=null&&n.folder?s.jsx(Ks,{entries:[n.folder],children:e}):t!=null&&t.length?s.jsx(Ks,{entries:t,children:e}):null}function Ks({entries:e,children:t}){const n=Rt(e);return s.jsx(Bt,{actions:n,children:t})}function Qs({page:e,children:t}){const n=Ot(e);return s.jsx(Bt,{actions:n,children:t})}function Bt({actions:e,children:t}){return s.jsxs(ie,{children:[t,s.jsx(oe,{children:e.map(n=>s.jsx(L,{onSelected:()=>{n.execute()},value:n.key,startIcon:h.createElement(n.icon),children:s.jsx(d,{...n.label})},n.key))})]})}const Ut=Fn(e=>xe(e)),ws=[{key:"name",allowsSorting:!0,header:()=>s.jsx(d,{message:"Name"}),visibleInMode:"all",width:"flex-3 min-w-200",body:e=>s.jsx(Na,{entry:e})},{key:"updated_at",allowsSorting:!0,maxWidth:"max-w-184",header:()=>s.jsx(d,{message:"Last modified"}),body:e=>s.jsx(Be,{date:e.updated_at})},{key:"file_size",allowsSorting:!0,header:()=>s.jsx(d,{message:"Size"}),maxWidth:"max-w-144",body:e=>Ut(e.file_size)??"-"},{key:"actions",hideHeader:!0,header:()=>s.jsx(d,{message:"Actions"}),align:"end",width:"w-42 flex-shrink-0",visibleInMode:"all",body:e=>s.jsx(Fa,{entry:e})}];function Na({entry:e}){const{isCollapsedMode:t}=h.useContext(ms),n=t?"w-30 h-30":"w-24 h-24";return s.jsxs("div",{className:"flex items-center gap-14",children:[s.jsx(ds,{className:D("rounded",n),iconClassName:n,file:e}),s.jsxs("div",{className:"min-w-0",children:[s.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:e.name}),t&&s.jsxs("div",{className:"text-muted text-xs flex items-center mt-4",children:[s.jsx(Be,{date:e.updated_at}),s.jsx("div",{children:"·"}),s.jsx("div",{children:Ut(e.file_size)})]})]})]})}function Fa({entry:e}){const{selectedRows:t}=h.useContext(ms);return t.length?s.jsx(nt,{className:"block mr-8",checked:t.includes(e.id)}):s.jsx(ss,{entries:[e],children:s.jsx(M,{className:"text-muted",children:s.jsx(fs,{})})})}const Ca=ws.filter(e=>e.key!=="updated_at");function Ma({entries:e,onEntrySelected:t}){const n=U(a=>a.activeSort),r=tt();return s.jsx(ft,{columns:r?Ca:ws,data:e,sortDescriptor:n,onSortChange:a=>{fe().setActiveSort(a)},onAction:(a,i)=>{t(a,i)},enableSelection:!1})}function Aa(e,t){var r;let n=e.hash;return t&&((r=e.entry)==null?void 0:r.hash)!==t&&(n=`${n}:${t}`),n}function Wt(){const{link:e}=te(),t=Cn();return n=>{e&&t(`/drive/s/${Aa(e,n)}`)}}function La({className:e}){const{pathname:t}=rt(),n=Wt(),[r,a]=h.useState(),i=U(j=>j.viewMode),o=h.useRef(null),{link:l,entries:c,isFetchingNextPage:u,hasNextPage:x,fetchNextPage:m,isPreviousData:g}=te();if(h.useEffect(()=>{a(void 0)},[t]),h.useEffect(()=>{const j=o.current;if(!j)return;const b=new IntersectionObserver(([S])=>{S.isIntersecting&&x&&m()});return b.observe(j),()=>{b.unobserve(j)}},[x,m]),!l||g)return s.jsx("div",{className:D("flex justify-center",e),children:s.jsx(pe,{isIndeterminate:!0})});const v=(j,b)=>{j.type==="folder"?n(j.hash):a(b)},y=c||[];return s.jsxs(h.Fragment,{children:[s.jsx(is,{slot:"file-preview",className:"mb-40"}),s.jsxs("div",{className:D("px-14 pb-14 md:px-24 md:pb-24 flex-auto overflow-auto file-grid-container",e),children:[i==="grid"?s.jsx(Qr,{entries:y,onEntrySelected:v}):s.jsx(Ma,{entries:y,onEntrySelected:v}),s.jsx("span",{ref:o,"aria-hidden":!0}),s.jsx(Q,{children:u&&s.jsx($.div,{className:"flex justify-center mt-24 w-full",...os,children:s.jsx(pe,{isIndeterminate:!0,"aria-label":"loading"})})})]}),s.jsx(ce,{type:"modal",isOpen:r!=null,onClose:()=>a(void 0),children:s.jsx(ht,{entries:y,defaultActiveIndex:r,allowDownload:l.allow_download})})]})}function Vt({children:e,className:t}){return s.jsx("div",{className:D(t,"dashboard-grid-header"),children:e})}function Kt({hash:e,params:t,isEnabled:n=!0}){return le(R.fetchFolderPath(e,t),()=>Ra(e,t),{enabled:!!e&&n})}function Ra(e,t){return E.get(`folders/${e}/path`,{params:t}).then(n=>n.data)}function Ta({className:e,folder:t,link:n}){const r=Wt(),a=U(l=>l.password),i=Kt({hash:t==null?void 0:t.hash,params:{shareable_link:n.id,password:a}});let o;if(i.isLoading)o=null;else{const l=[];i.data&&i.data.path.forEach(c=>{l.push({folder:c,label:s.jsx(s.Fragment,{children:c.name})})}),o=s.jsx(js,{size:"lg",isNavigation:!0,children:l.map(c=>s.jsx(Ke,{onSelected:()=>{r(c.folder.hash)},children:c.label},c.folder.hash))})}return s.jsx("div",{className:D("h-36 flex-shrink-0",e),children:o})}const qs=[{id:"file_size",label:f("Size")},{id:"name",label:f("Name")},{id:"updated_at",label:f("Last modified")},{id:"created_at",label:f("Upload date")},{id:"type",label:f("Type")},{id:"extension",label:f("Extension")}];function Qt({descriptor:e,onChange:t,isDisabled:n=!1}){const r=e.orderBy,a=e.orderDir,i=qs.find(o=>o.id===r);return s.jsxs(ie,{showCheckmark:!0,selectionMode:"multiple",selectedValue:[a||"desc",r||""],onItemSelected:o=>{t(o==="asc"||o==="desc"?{orderBy:r,orderDir:o}:{orderBy:o,orderDir:a})},children:[s.jsx(P,{className:"text-muted",variant:"text",size:"sm",startIcon:s.jsx(kr,{}),disabled:n,children:i?s.jsx(d,{...i.label}):null}),s.jsxs(oe,{children:[s.jsxs(Rs,{label:s.jsx(d,{message:"Direction"}),children:[s.jsx(L,{value:"asc",children:s.jsx(d,{message:"Ascending"})}),s.jsx(L,{value:"desc",children:s.jsx(d,{message:"Descending"})})]}),s.jsx(Rs,{label:s.jsx(d,{message:"Sort By"}),children:qs.map(o=>s.jsx(L,{value:o.id,children:s.jsx(d,{...o.label})},o.id))})]})]})}function _a(){const e=U(a=>a.activeSort),{link:t,isFetching:n}=te(),r=t&&t.entry;return s.jsxs("div",{className:"md:flex-row flex flex-col md:items-center gap-14 justify-between p-14 md:p-24 md:h-90",children:[r&&s.jsx(Ta,{link:t,folder:t.entry,className:"flex-auto"}),r&&s.jsxs("div",{className:"flex items-center justify-between md:justify-start text-muted",children:[s.jsx(Qt,{isDisabled:n,descriptor:e,onChange:a=>{fe().setActiveSort(a)}}),s.jsx("div",{className:"md:border-l md:pl-10 ml-10",children:s.jsx(M,{onClick:()=>{fe().setViewMode(fe().viewMode==="grid"?"list":"grid")},children:s.jsx(Ir,{})})})]})]})}function za(){const{entries:e,isFetched:t}=te(),n=t&&!(e!=null&&e.length);return s.jsxs(xt,{name:"folder-preview",children:[s.jsx(pt,{hideToggleButton:!0,rightChildren:s.jsx(Dt,{}),color:"bg"}),s.jsx(Vt,{children:s.jsx(_a,{})}),s.jsx(at,{children:s.jsx(gt,{children:n?s.jsx($a,{}):s.jsx(La,{})})})]})}function $a({className:e}){return s.jsx(Ye,{className:D(e,"mt-80"),image:s.jsx(ke,{src:Ct}),title:s.jsx(d,{message:"Folder is empty"}),description:s.jsx(d,{message:"No files have been uploaded to this folder yet"})})}function Oa(){const{link:e}=te();return e!=null&&e.entry?s.jsxs("div",{className:"flex flex-col h-screen bg-alt",children:[s.jsx(Pt,{}),s.jsx(is,{slot:"file-preview",className:"mt-24"}),s.jsx(sr,{entries:[e.entry],showHeader:!1,allowDownload:e.allow_download})]}):null}function Ba(){var o;const{status:e,link:t}=te(),{trans:n}=B(),r=U(l=>l.isPasswordProtected),a=U(l=>l.password);let i;if(e==="loading")i=s.jsx("div",{className:"flex-auto flex items-center justify-center h-screen",children:s.jsx(pe,{"aria-label":n({message:"Loading link"}),isIndeterminate:!0})});else{if(!t&&!r)return s.jsx(it,{});r&&!a?i=s.jsx(Vr,{}):((o=t==null?void 0:t.entry)==null?void 0:o.type)==="folder"?i=s.jsx(za,{}):i=s.jsx(Oa,{})}return s.jsx(vt.Provider,{value:{shareable_link:t==null?void 0:t.id,password:a},children:i})}function Ua(e){return s.jsx(Mn,{...e,role:"meter progressbar"})}function Wa(){const{isLoading:e,data:t}=$t(),n=s.jsx("span",{className:D("whitespace-nowrap",e&&"invisible"),children:s.jsx(d,{message:":used of :available used",values:{used:t==null?void 0:t.usedFormatted,available:t==null?void 0:t.availableFormatted}})});return s.jsxs("div",{className:"pl-24 pt-24 mt-24 border-t flex items-start gap-16",children:[s.jsx(Er,{className:"icon-md -mt-4"}),s.jsx(Ua,{className:"flex-auto max-w-144",size:"xs",value:t==null?void 0:t.percentage,label:n,showValueLabel:!1,labelPosition:"bottom"})]})}function Va(e){return F(t=>Ka(t),{onSuccess:()=>{N(f("Created workspace")),C.invalidateQueries(V.fetchUserWorkspaces)},onError:t=>Ie(t,e)})}function Ka(e){return E.post("workspace",e).then(t=>t.data)}function Qa(){const e=Ee(),{formId:t,close:n}=q(),r=Va(e);return s.jsxs(Z,{children:[s.jsx(J,{children:s.jsx(d,{message:"Create workspace"})}),s.jsx(Y,{children:s.jsx(De,{form:e,id:t,onSubmit:()=>{r.mutate(e.getValues(),{onSuccess:a=>{n(a.workspace.id)}})},children:s.jsx(Pe,{name:"name",autoFocus:!0,label:s.jsx(d,{message:"Workspace name"}),minLength:3,required:!0})})}),s.jsxs(ve,{children:[s.jsx(P,{variant:"text",onClick:n,children:s.jsx(d,{message:"Cancel"})}),s.jsx(P,{variant:"flat",color:"primary",type:"submit",form:t,disabled:r.isLoading,children:s.jsx(d,{message:"Create"})})]})]})}function qa(e){return E.get(`workspace/${e}`).then(t=>t.data)}function Ha(e){return le(V.workspaceWithMembers(e),()=>qa(e))}function Ya({workspaceId:e,...t}){return E.post(`workspace/${e}/invite`,t).then(n=>n.data)}function Ga(){return F(e=>Ya(e),{onSuccess:(e,t)=>{C.invalidateQueries(V.workspaceWithMembers(t.workspaceId))},onError:e=>T(e)})}function Xa({workspaceId:e,inviteId:t,...n}){return E.post(`workspace/${e}/${t}/resend`,n).then(r=>r.data)}function Za(){return F(e=>Xa(e),{onSuccess:()=>{N("Invite sent")},onError:e=>T(e)})}const Ja=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function qt(e){return!e||e.length>320?!1:Ja.test(e)}function ei({workspaceId:e,member:t,...n}){const r=t.model_type,a=t.model_type==="invite"?t.id:t.member_id;return E.post(`workspace/${e}/${r}/${a}/change-role`,n).then(i=>i.data)}function si(){return F(e=>ei(e),{onSuccess:(e,t)=>{N(f("Role changed")),C.invalidateQueries(V.workspaceWithMembers(t.workspaceId))},onError:e=>T(e)})}function ti({workspaceId:e,memberId:t,memberType:n}){const r=n==="invite"?`workspace/invite/${t}`:`workspace/${e}/member/${t}`;return E.delete(r).then(a=>a.data)}function Ht(){const{workspaceId:e,setWorkspaceId:t}=K(),{user:n}=W();return F(r=>ti(r),{onSuccess:(r,a)=>{C.invalidateQueries(V.fetchUserWorkspaces),C.invalidateQueries(V.workspaceWithMembers(a.workspaceId)),a.memberId===(n==null?void 0:n.id)&&e===a.workspaceId&&t(ls.id)},onError:r=>T(r)})}function Yt(){return s.jsx(je,{isDanger:!0,title:s.jsx(d,{message:"Leave workspace"}),body:s.jsxs("div",{children:[s.jsx(d,{message:"Are you sure you want to leave this workspace?"}),s.jsx("div",{className:"font-semibold mt-8",children:s.jsx(d,{message:"All resources you've created in the workspace will be transferred to workspace owner."})})]}),confirm:s.jsx(d,{message:"Leave"})})}function ni({workspace:e}){const{data:t,isLoading:n}=Ha(e.id);return s.jsxs(Z,{size:"lg",children:[s.jsx(J,{children:s.jsx(d,{message:"Manage workspace members"})}),s.jsx(Y,{children:n?s.jsx("div",{className:"flex items-center justify-center min-h-[238px]",children:s.jsx(pe,{isIndeterminate:!0,"aria-label":"Loading workspace..."})}):s.jsx(ri,{workspace:t.workspace})})]})}function ri({workspace:e}){const t=Ss(e),n=[...e.members||[],...e.invites||[]];return s.jsxs("div",{children:[t.invite&&s.jsx(oi,{workspace:e}),s.jsxs("div",{className:"flex items-center gap-10 mb-14 text-base",children:[s.jsx(Dr,{className:"icon-sm"}),s.jsx(d,{message:"Members of `:workspace`",values:{workspace:e.name}})]}),s.jsx(Q,{initial:!1,children:n.map(r=>s.jsx(ai,{workspace:e,member:r},`${r.model_type}.${r.id}`))})]})}function ai({workspace:e,member:t}){return s.jsxs($.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"flex items-start text-sm gap-14 mb-20",children:[s.jsx("img",{className:"w-36 h-36 rounded flex-shrink-0",src:t.avatar,alt:""}),s.jsxs("div",{className:"md:flex flex-auto items-center justify-between gap-14 min-w-0",children:[s.jsxs("div",{className:"overflow-hidden mb-10 md:mb-0 md:mr-10",children:[s.jsxs("div",{className:"flex items-center justify-start gap-6",children:[s.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap",children:t.display_name}),s.jsx(di,{workspace:e,member:t})]}),s.jsx("div",{className:"text-muted",children:t.email})]}),s.jsx(ii,{workspace:e,member:t})]})]},`${t.model_type}.${t.id}`)}function Ss(e){var i;const{user:t}=W(),n={update:!1,invite:!1,delete:!1},r=["update","invite","delete"],a=(i=e.members)==null?void 0:i.find(o=>o.id===(t==null?void 0:t.id));return a&&r.forEach(o=>{var l;n[o]=a.is_owner||!!((l=a.permissions)!=null&&l.find(c=>c.name===`workspace_members.${o}`))}),n}function ii({workspace:e,member:t}){const[n,r]=h.useState(t.role_id),a=si(),{user:i}=W(),o=Ss(e),l=t.model_type==="member"&&t.is_owner,c=t.model_type==="member"&&(i==null?void 0:i.id)===t.id,u=!o.update||l||c?s.jsx("div",{className:"text-muted ml-auto first:capitalize",children:s.jsx(d,{message:t.role_name})}):s.jsx(Gt,{className:"ml-auto flex-shrink-0",size:"xs",value:n,isDisabled:a.isLoading,onChange:x=>{r(x),a.mutate({roleId:x,workspaceId:e.id,member:t})}});return s.jsxs(s.Fragment,{children:[u,!l&&(c||o.delete)&&s.jsx(li,{type:c?"leave":"remove",member:t,workspace:e})]})}function oi({workspace:e}){const{trans:t}=B(),[n,r]=h.useState([]),a=n.every(x=>!x.invalid),i=x=>x.description||x.name,[o,l]=h.useState(),c=Ga(),{data:u}=ot(["workspaceRoles"]);return h.useEffect(()=>{var x;!o&&((x=u==null?void 0:u.workspaceRoles)!=null&&x.length)&&l(u.workspaceRoles[0].id)},[u,o]),s.jsxs("div",{className:"mb-30",children:[s.jsx(hs,{value:n,onChange:r,displayWith:i,validateWith:x=>{const m=!qt(x.description);return{...x,invalid:m,errorMessage:m?t({message:"Not a valid email"}):void 0}},placeholder:t({message:"Enter email addresses"}),label:s.jsx(d,{message:"Invite people"})}),s.jsxs("div",{className:"flex items-center gap-14 justify-between mt-14",children:[s.jsx(Gt,{onChange:l,value:o}),n.length&&o?s.jsx(P,{variant:"flat",color:"primary",size:"sm",disabled:c.isLoading||!a,onClick:()=>{c.mutate({emails:n.map(x=>i(x)),roleId:o,workspaceId:e.id},{onSuccess:()=>{r([])}})},children:s.jsx(d,{message:"Invite"})}):null]})]})}function li({member:e,workspace:t,type:n}){const r=Ht(),{close:a}=q();return s.jsxs(ce,{type:"modal",onClose:i=>{i&&(r.mutate({workspaceId:t.id,memberId:e.id,memberType:e.model_type}),n==="leave"&&(a(),N(f("Left workspace"))))},children:[s.jsx(M,{size:"md",className:"text-muted flex-shrink-0",disabled:r.isLoading,children:n==="leave"?s.jsx(lt,{}):s.jsx(be,{})}),n==="leave"?s.jsx(Yt,{}):s.jsx(ci,{member:e})]})}function ci({member:e}){return s.jsx(je,{isDanger:!0,title:s.jsx(d,{message:"Remove member"}),body:s.jsxs("div",{children:[s.jsx(d,{message:"Are you sure you want to remove `:name`?",values:{name:e.display_name}}),s.jsx("div",{className:"font-semibold mt-8",children:s.jsx(d,{message:"All workspace resources created by `:name` will be transferred to workspace owner.",values:{name:e.display_name}})})]}),confirm:s.jsx(d,{message:"Remove"})})}function Gt({value:e,onChange:t,size:n="xs",className:r,isDisabled:a}){var l;const{data:i}=ot(["workspaceRoles"]),o=(l=i==null?void 0:i.workspaceRoles)==null?void 0:l.find(c=>c.id===e);return!e||!o||!(i!=null&&i.workspaceRoles)?null:s.jsxs(ie,{selectionMode:"single",selectedValue:e,onSelectionChange:c=>{t(c)},children:[s.jsx(P,{className:r,size:n,variant:"flat",color:"chip",disabled:a,endIcon:s.jsx(cs,{}),children:s.jsx(d,{message:o.name})}),s.jsx(oe,{children:i.workspaceRoles.map(c=>s.jsx(L,{value:c.id,description:c.description,children:s.jsx(d,{message:c.name})},c.id))})]})}function di({member:e,workspace:t}){const{user:n}=W(),r=Ss(t);return(n==null?void 0:n.id)===e.id?s.jsxs("div",{className:"font-medium",children:["(",s.jsx(d,{message:"You"}),")"]}):e.model_type==="invite"?s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{children:"·"}),s.jsx("div",{className:"font-medium",children:s.jsx(d,{message:"Invited"})}),r.invite?s.jsxs(s.Fragment,{children:[s.jsx("div",{children:"·"}),s.jsx(ui,{member:e,workspace:t})]}):null]}):null}function ui({member:e,workspace:t}){const n=Za();return s.jsxs(ce,{type:"modal",onClose:r=>{r&&n.mutate({workspaceId:t.id,inviteId:e.id})},children:[s.jsx(P,{variant:"link",size:"sm",color:"primary",disabled:n.isLoading,children:s.jsx(d,{message:"Resend invite"})}),s.jsx(je,{title:s.jsx(d,{message:"Resend invite"}),body:s.jsx(d,{message:"Are you sure you want to send this invite again?"}),confirm:s.jsx(d,{message:"Send"})})]})}function mi({id:e,...t}){return E.put(`workspace/${e}`,t).then(n=>n.data)}function fi(e){const{close:t}=q();return F(n=>mi(n),{onSuccess:n=>{t(),N(f("Updated workspace")),C.invalidateQueries(V.fetchUserWorkspaces),C.invalidateQueries(V.workspaceWithMembers(n.workspace.id))},onError:n=>Ie(n,e)})}function hi({workspace:e}){const t=Ee({defaultValues:{id:e.id,name:e.name}}),{formId:n,close:r}=q(),a=fi(t);return s.jsxs(Z,{children:[s.jsx(J,{children:s.jsx(d,{message:"Rename workspace"})}),s.jsx(Y,{children:s.jsx(De,{form:t,id:n,onSubmit:()=>{a.mutate(t.getValues())},children:s.jsx(Pe,{name:"name",autoFocus:!0,label:s.jsx(d,{message:"Name"}),minLength:3,required:!0})})}),s.jsxs(ve,{children:[s.jsx(P,{variant:"text",onClick:r,children:s.jsx(d,{message:"Cancel"})}),s.jsx(P,{variant:"flat",color:"primary",type:"submit",form:n,disabled:a.isLoading,children:s.jsx(d,{message:"Rename"})})]})]})}function xi({id:e}){return E.delete(`workspace/${e}`).then(t=>t.data)}function pi(){const{workspaceId:e,setWorkspaceId:t}=K();return F(n=>xi(n),{onSuccess:(n,r)=>{N(f("Deleted workspace")),C.invalidateQueries(V.fetchUserWorkspaces),C.invalidateQueries(V.workspaceWithMembers(r.id)),e===r.id&&t(ls.id)},onError:n=>T(n)})}function gi({onChange:e,className:t,trigger:n}){const{data:r,isFetched:a,isFetching:i}=An(),{workspaceId:o,setWorkspaceId:l}=K(),c=r==null?void 0:r.find(b=>b.id===o),[u,x]=h.useState(null),[m,g]=h.useState(!1),{hasPermission:v}=W();if(h.useEffect(()=>{a&&!i&&!c&&l(ls.id)},[c,r,l,a,i]),!c||!v("workspaces.create"))return null;const y=s.jsxs(ct,{className:D("flex items-center gap-10 hover:bg-hover rounded ring-inset focus-visible:ring-2",t),children:[s.jsxs("span",{className:"block flex-auto mr-auto text-left overflow-hidden",children:[s.jsx("span",{className:"block text-sm text-main font-medium overflow-hidden overflow-ellipsis",children:c.default?s.jsx(d,{message:c.name}):c.name}),s.jsx("span",{className:"block text-muted text-xs",children:c.default?s.jsx(d,{message:"Personal workspace"}):s.jsx(d,{message:":count members",values:{count:c.members_count}})})]}),s.jsx(tr,{className:"icon-md shrink-0"})]}),j=n||y;return s.jsxs(h.Fragment,{children:[s.jsxs(ce,{type:"popover",isOpen:m,onClose:()=>{g(!1)},children:[h.cloneElement(j,{onClick:()=>g(!m)}),s.jsx(Z,{size:"min-w-320",children:s.jsxs(Y,{padding:"p-10",children:[s.jsx("div",{className:"mb-16 pb-10 border-b",children:r.map(b=>s.jsx(vi,{workspace:b,setDialog:x,setSelectorIsOpen:g,onChange:e},b.id))}),s.jsx("div",{className:"text-center mb-4 px-4",children:s.jsx(P,{onClick:b=>{b.preventDefault(),b.stopPropagation(),x({name:"newWorkspace"}),g(!1)},variant:"outline",startIcon:s.jsx(jt,{}),color:"primary",className:"w-full h-40",children:s.jsx(d,{message:"Create new workspace"})})})]})})]}),s.jsx(ji,{dialog:u,setDialog:x,onChange:e})]})}function vi({workspace:e,onChange:t,setSelectorIsOpen:n,setDialog:r}){const{workspaceId:a,setWorkspaceId:i}=K(),o=a===e.id;return s.jsxs("div",{onClick:()=>{i(e.id),t==null||t(e.id),n(!1)},className:D("p-10 mb-4 text-left flex items-center gap-12 rounded-lg cursor-pointer",o&&"bg-primary/5",!o&&"hover:bg-hover"),children:[s.jsx(Ln,{size:"sm",className:D("flex-shrink-0 text-primary",!o&&"invisible")}),s.jsxs("div",{className:"flex-auto",children:[s.jsx("div",{className:D("text-sm",o&&"font-semibold"),children:e.name}),s.jsx("div",{className:"text-muted text-sm",children:e.default?s.jsx(d,{message:"Personal workspace"}):s.jsx(d,{message:":count members",values:{count:e.members_count}})})]}),e.id!==0&&s.jsx(yi,{setSelectorIsOpen:n,workspace:e,setDialog:r})]})}function ji({dialog:e,setDialog:t,onChange:n}){const r=pi(),a=Ht(),{user:i}=W(),{setWorkspaceId:o}=K();return s.jsxs(ce,{type:"modal",isOpen:!!(e!=null&&e.name),onClose:l=>{(e==null?void 0:e.name)==="deleteWorkspace"&&l&&r.mutate({id:e.workspace.id}),(e==null?void 0:e.name)==="leaveWorkspace"&&l&&(i!=null&&i.id)&&a.mutate({workspaceId:e.workspace.id,memberId:i.id,memberType:"member"}),(e==null?void 0:e.name)==="newWorkspace"&&l&&(o(l),n==null||n(l)),t(null)},children:[(e==null?void 0:e.name)==="newWorkspace"&&s.jsx(Qa,{}),(e==null?void 0:e.name)==="updateWorkspace"&&s.jsx(hi,{workspace:e.workspace}),(e==null?void 0:e.name)==="workspaceMembers"&&s.jsx(ni,{workspace:e.workspace}),(e==null?void 0:e.name)==="deleteWorkspace"&&s.jsx(bi,{workspace:e.workspace}),(e==null?void 0:e.name)==="leaveWorkspace"&&s.jsx(Yt,{})]})}function bi({workspace:e}){return s.jsx(je,{isDanger:!0,title:s.jsx(d,{message:"Delete workspace"}),body:s.jsx(d,{message:"Are you sure you want to delete “:name“?",values:{name:e.name}}),confirm:s.jsx(d,{message:"Delete"})})}function yi({setSelectorIsOpen:e,setDialog:t,workspace:n}){const{user:r}=W();return s.jsxs(ie,{onItemSelected:a=>{e(!1),t({name:a,workspace:n})},children:[s.jsx(P,{onClick:a=>{a.preventDefault(),a.stopPropagation()},color:"primary",size:"xs",variant:"outline",endIcon:s.jsx(st,{}),children:s.jsx(d,{message:"Manage"})}),s.jsxs(oe,{children:[s.jsx(L,{onClick:a=>a.stopPropagation(),value:"workspaceMembers",startIcon:s.jsx(St,{}),children:s.jsx(d,{message:"Members"})}),n.owner_id===(r==null?void 0:r.id)&&s.jsx(L,{onClick:a=>a.stopPropagation(),value:"updateWorkspace",startIcon:s.jsx(Rr,{}),children:s.jsx(d,{message:"Rename"})}),n.owner_id!==(r==null?void 0:r.id)&&s.jsx(L,{onClick:a=>a.stopPropagation(),value:"leaveWorkspace",startIcon:s.jsx(lt,{}),children:s.jsx(d,{message:"Leave"})}),n.owner_id===(r==null?void 0:r.id)&&s.jsx(L,{onClick:a=>a.stopPropagation(),value:"deleteWorkspace",startIcon:s.jsx(us,{}),children:s.jsx(d,{message:"Delete"})})]})]})}var Xt=(e=>(e.DriveSidebar="drive-sidebar",e))(Xt||{}),Zt={};(function(e){var t=Ts&&Ts.__assign||function(){return(t=Object.assign||function(o){for(var l,c=1,u=arguments.length;c<u;c++)for(var x in l=arguments[c])Object.prototype.hasOwnProperty.call(l,x)&&(o[x]=l[x]);return o}).apply(this,arguments)},n=(Object.defineProperty(e,"__esModule",{value:!0}),{id:"id",parentId:"parentId",dataField:"data",childrenField:"children",throwIfOrphans:!1,rootParentIds:{"":!(e.countNodes=e.arrayToTree=void 0)},nestedIds:!0,assign:!1});function r(o,l){l===void 0&&(l={});for(var c,u=t(t({},n),l),x=[],m={},g=u.throwIfOrphans?new Set:null,v=0,y=o;v<y.length;v++){var j=y[v],b=u.nestedIds?i(j,u.id):j[u.id],S=u.nestedIds?i(j,u.parentId):j[u.parentId];if(u.rootParentIds[b])throw new Error("The item array contains a node whose parentId both exists in another node and is in "+'`rootParentIds` (`itemId`: "'.concat(b,'", `rootParentIds`: ').concat(Object.keys(u.rootParentIds).map(function(z){return'"'.concat(z,'"')}).join(", "),")."));Object.prototype.hasOwnProperty.call(m,b)||(m[b]=((c={})[u.childrenField]=[],c)),g&&g.delete(b),u.dataField?m[b][u.dataField]=j:u.assign?m[b]=Object.assign(j,((c={})[u.childrenField]=m[b][u.childrenField],c)):m[b]=t(t({},j),((j={})[u.childrenField]=m[b][u.childrenField],j)),j=m[b],S==null||u.rootParentIds[S]?x.push(j):(Object.prototype.hasOwnProperty.call(m,S)||(m[S]=((b={})[u.childrenField]=[],b),g&&g.add(S)),m[S][u.childrenField].push(j))}if(g!=null&&g.size)throw new Error("The items array contains orphans that point to the following parentIds: "+"[".concat(Array.from(g),"]. These parentIds do not exist in the items array. Hint: prevent orphans to result ")+"in an error by passing the following option: { throwIfOrphans: false }");if(u.throwIfOrphans&&a(x,u.childrenField)<Object.keys(m).length)throw new Error("The items array contains nodes with a circular parent/child relationship.");return x}function a(o,l){return o.reduce(function(c,u){return c+1+(u[l]&&a(u[l],l))},0)}function i(o,l){return l.split(".").reduce(function(c,u){return c&&c[u]},o)}e.arrayToTree=r,e.countNodes=a})(Zt);function wi(e){return E.get(`users/${e.userId}/folders`,{params:e}).then(t=>t.data)}function ks(){const{user:e}=W(),{workspaceId:t}=K(),n={userId:e.id,workspaceId:t};return le(R.fetchUserFolders(n),()=>wi(n),{enabled:!!e})}function Jt(){return F(e=>(N.loading(f("Moving [one 1 item|other :count items]...",{values:{count:e.entryIds.length}}),{disableExitAnimation:!0}),Si(e)),{onSuccess:(e,t)=>{O(),N(f('Moved [one 1 item|other :count items] to ":destination"',{values:{count:t.entryIds.length,destination:(e.destination||_.folder).name}}),{disableEnterAnimation:!0})},onError:e=>T(e,f("Could not move items"),null,{disableEnterAnimation:!0})})}function Si(e){return e.destinationId=e.destinationId?e.destinationId:null,E.post("file-entries/move",e).then(t=>t.data)}function Is(e,t){return t.type!=="folder"?!1:e.every(n=>!n||t.id===n.parent_id||!n.parent_id&&t.id===0?!1:!ki(t,n))}function ki(e,t){const n=(e.path||"").split("/");return(t.path||"").split("/").every((a,i)=>n[i]===a)}function en(e){const t=Jt(),{uploadFiles:n}=Ce();return{onDrop:async a=>{if(e.type==="folder"){if(a.type==="nativeFile")n(await a.getData(),{metadata:{parentId:e.id}});else if(a.type==="fileEntry"){const i=a.getData();i!=null&&i.length&&Is(i,e)&&(t.mutate({destinationId:e.id,entryIds:i.map(o=>o.id)}),p().deselectEntries("all"))}}}}}function ns(e,t){if(e.type==="fileEntry"){const n=e.getData();return Is(n,t)}return!0}function Es(e){return`${e.id}-tree`}function Ii(e){return`${e}`.endsWith("-tree")}function Ei({folder:e,ref:t}){const[n,r]=h.useState(!1),{onDrop:a}=en(e);return{...Je({id:Es(e),ref:t,types:["fileEntry","nativeFile"],acceptsDrop:o=>ns(o,e),onDragEnter:o=>{ns(o,e)&&r(!0)},onDragLeave:()=>{r(!1)},onDropActivate:()=>{p().sidebarExpandedKeys.includes(e.id)||p().setSidebarExpandedKeys([...p().sidebarExpandedKeys,e.id])},onDrop:a}),isDragOver:n}}const Ds=h.createContext(null);function sn({nodes:e,itemRenderer:t,parentNode:n,level:r}){return e.map((a,i)=>h.cloneElement(t(a),{level:r==null?0:r+1,index:i,node:a,parentNode:n,key:a.id,itemRenderer:t}))}const tn=h.forwardRef(({icon:e,label:t,level:n=0,node:r,className:a,...i},o)=>{const{expandedKeys:l,setExpandedKeys:c,selectedKeys:u,setSelectedKeys:x}=h.useContext(Ds),m=l.includes(r.id),g=u.includes(r.id),v=y=>{y.stopPropagation();const j=l.indexOf(r.id),b=[...l];j>-1?b.splice(j,1):b.push(r.id),c(b)};return s.jsxs("div",{...i,ref:o,onClick:y=>{y.stopPropagation(),x([r.id])},className:D("flex flex-nowrap whitespace-nowrap items-center gap-4 py-6 rounded header cursor-pointer overflow-hidden text-ellipsis tree-label",a,g&&"bg-primary/selected text-primary font-bold",!g&&"hover:bg-hover"),children:[n>0&&s.jsx("div",{className:"flex",children:Array.from({length:n}).map((y,j)=>s.jsx("div",{className:"w-24 h-24"},j))}),s.jsx("div",{onClick:v,children:s.jsx(Pr,{className:D("icon-sm cursor-default transition-transform",m&&"rotate-90")})}),e,s.jsx("div",{className:"overflow-hidden text-ellipsis pr-6",children:t})]})});tn.displayName="TreeLabel";function Di({label:e,icon:t,node:n,level:r,index:a,itemRenderer:i,labelRef:o,labelClassName:l,className:c,parentNode:u,...x}){const m=Rn(),{expandedKeys:g,selectedKeys:v,focusedNode:y,setFocusedNode:j,setExpandedKeys:b,setSelectedKeys:S}=h.useContext(Ds);if(h.useEffect(()=>()=>{y===(n==null?void 0:n.id)&&j(void 0)},[y,n==null?void 0:n.id,j]),!n||!i)return null;const z=n.children.length,k=z&&g.includes(n.id),de=v.includes(n.id),Me=r===0&&a===0,Ae=y==null?Me:y===n.id,Le=I=>{var ye,Ms;if(y!=null)switch(I.key){case"Enter":case" ":I.stopPropagation(),I.preventDefault(),S([y]);break;case"ArrowRight":if(I.stopPropagation(),I.preventDefault(),!z)return;k?m.focusNext():b([...g,y]);break;case"ArrowLeft":if(I.stopPropagation(),I.preventDefault(),k){const G=g.indexOf(y),ue=[...g];ue.splice(G,1),b(ue)}else if(u){const G=(Ms=(ye=document.activeElement)==null?void 0:ye.parentElement)==null?void 0:Ms.closest("[tabindex]");G&&G.focus()}break;case"ArrowDown":I.stopPropagation(),I.preventDefault(),m.focusNext();break;case"ArrowUp":I.stopPropagation(),I.preventDefault(),m.focusPrevious();break;case"Home":I.stopPropagation(),I.preventDefault(),m.focusFirst();break;case"End":I.stopPropagation(),I.preventDefault(),m.focusLast();break;case"*":if(I.stopPropagation(),I.preventDefault(),u!=null&&u.children){const G=[...g];u.children.forEach(ue=>{ue.children.length&&!g.includes(ue.id)&&G.push(ue.id)}),G.length!==g.length&&b(G)}break}};return s.jsxs("li",{role:"treeitem","aria-expanded":k?"true":"false","aria-selected":de,tabIndex:Ae?0:-1,onKeyDown:Ue(Le),onFocus:I=>{I.stopPropagation(),j(n.id)},onBlur:I=>{I.stopPropagation(),I.currentTarget.contains(I.relatedTarget)||j(void 0)},className:D("outline-none","[&>.tree-label]:focus-visible:ring [&>.tree-label]:focus-visible:ring-2 [&>.tree-label]:focus-visible:ring-inset",c),children:[s.jsx(tn,{ref:o,className:l,node:n,level:r,label:e,icon:t,...x}),s.jsx(Q,{initial:!1,children:k?s.jsx($.ul,{role:"group",initial:"closed",animate:"open",exit:"closed",variants:{open:{opacity:1,height:"auto"},closed:{opacity:0,height:0,overflow:"hidden"}},children:sn({nodes:n.children,parentNode:n,itemRenderer:i,level:r})},`${n.id}-group`):null})]})}function Pi({children:e,nodes:t,...n}){const[r,a]=_s(n.expandedKeys,n.defaultSelectedKeys,n.onExpandedKeysChange),[i,o]=_s(n.selectedKeys,n.defaultSelectedKeys,n.onSelectedKeysChange),[l,c]=h.useState(),u={expandedKeys:r,setExpandedKeys:a,selectedKeys:i,setSelectedKeys:o,focusedNode:l,setFocusedNode:c};return s.jsx(Ds.Provider,{value:u,children:s.jsx(Tn,{children:s.jsx(Ni,{nodes:t,itemRenderer:e})})})}function Ni(e){return s.jsx("ul",{className:"overflow-hidden text-sm",role:"tree",children:sn(e)})}function Fi(){const e=ee(),{data:t}=ks(),n=w(o=>o.sidebarExpandedKeys),r=w(o=>o.activePage);let a=[];r!=null&&r.isFolderPage&&(a=r.folder?[r.folder.id]:[]);const i=h.useMemo(()=>{const o=Zt.arrayToTree((t==null?void 0:t.folders)||[],{parentId:"parent_id",dataField:null});return[{..._.folder,children:o}]},[t==null?void 0:t.folders]);return s.jsx(Pi,{nodes:i,expandedKeys:n,onExpandedKeysChange:o=>{p().setSidebarExpandedKeys(o)},selectedKeys:a,onSelectedKeysChange:([o])=>{const l=nn(o,i);e(l?es(l):_.path)},children:()=>s.jsx(Ci,{})})}function Ci(e){const{node:t}=e,n=h.useRef(null),r=t.id===0,a=w(c=>c.entriesBeingDragged.includes(t.id)),{draggableProps:i}=bt({type:"fileEntry",id:Es(t),ref:n,disabled:r,hidePreview:!0,onDragStart:(c,u)=>{const x=u;p().setEntriesBeingDragged(x.getData().map(m=>m.id)),p().selectEntries([])},onDragEnd:()=>{p().setEntriesBeingDragged([])},getData:()=>[t]}),{droppableProps:o,isDragOver:l}=Ei({folder:t,ref:n});return s.jsx(Di,{...Ge(i,o,e),onContextMenu:c=>{c.preventDefault(),c.stopPropagation(),p().deselectEntries("all"),p().setContextMenuData({x:c.clientX,y:c.clientY,entry:t})},labelRef:n,className:r?"focus-visible:ring-2":void 0,labelClassName:D(l&&"bg-primary/selected ring ring-2 ring-inset ring-primary",a&&"opacity-30",r&&"h-40"),icon:r?s.jsx(Nr,{size:"md",className:"mr-6"}):s.jsx(vs,{size:"sm",className:"mr-4"}),label:t.name})}const nn=(e,t)=>{for(const n of t){if(n.id===e)return n.hash;if(n.children){const r=nn(e,n.children);if(r)return r}}};function Mi(){return K(),s.jsxs("div",{className:"text-muted mt-26 px-12",children:[s.jsx(Fi,{}),s.jsx(zn,{menu:Xt.DriveSidebar,orientation:"vertical",gap:"gap-0",children:e=>e.action==="/drive/trash"?s.jsx(Ai,{item:e},e.id):s.jsx(rn,{item:e},e.id)})]})}const rn=h.forwardRef(({item:e,className:t,...n},r)=>s.jsx(_n,{className:({isActive:a})=>D(t,"h-40 w-full my-4 px-24 rounded",a?"text-primary font-bold bg-primary/selected cursor-default":"hover:bg-hover"),item:e,ref:r,...n}));function Ai({item:e}){const t=Fe(),[n,r]=h.useState(!1),a=h.useRef(null),{droppableProps:i}=Je({id:"trash",types:["fileEntry"],ref:a,onDragEnter:()=>{r(!0)},onDragLeave:()=>{r(!1)},onDrop:o=>{const l=o.getData().map(c=>c.id);t.mutate({entryIds:l,deleteForever:!1})}});return s.jsx(rn,{className:D(n&&"bg-primary/selected"),ref:a,...i,item:e})}function an({isCompact:e,className:t}){const n=w(i=>i.activePage),{uploadFiles:r}=Ce(),a=e?s.jsx(M,{size:"md",children:s.jsx(jt,{})}):s.jsx(P,{className:"min-w-160",color:"primary",variant:"flat",size:"sm",startIcon:s.jsx(kt,{}),disabled:!(n!=null&&n.canUpload),children:s.jsx(d,{message:"Upload"})});return s.jsx("div",{className:t,children:s.jsxs(ie,{onItemSelected:async i=>{var o;if(i==="uploadFiles")r(await Oe({multiple:!0}));else if(i==="uploadFolder")r(await Oe({directory:!0}));else if(i==="newFolder"){const l=(o=p().activePage)==null?void 0:o.folder;p().setActiveActionDialog("newFolder",l?[l]:[])}},children:[a,s.jsxs(oe,{children:[s.jsx(L,{value:"uploadFiles",startIcon:s.jsx(Fr,{}),children:s.jsx(d,{message:"Upload files"})}),s.jsx(L,{value:"uploadFolder",startIcon:s.jsx(It,{}),children:s.jsx(d,{message:"Upload folder"})}),s.jsx(L,{value:"newFolder",startIcon:s.jsx(gs,{}),children:s.jsx(d,{message:"Create folder"})})]})]})})}function Li({className:e}){const{isSubscribed:t}=W(),{billing:n}=He();return s.jsxs("div",{className:D(e,"text-sm text-muted font-medium bg-alt border-r flex flex-col gap-20"),children:[s.jsxs("div",{className:"flex-auto",children:[s.jsx(an,{className:"text-center px-12 pt-28"}),s.jsx(Mi,{}),s.jsx(Wa,{}),n.enable&&s.jsx("div",{className:"pl-60 mt-14",children:s.jsx(P,{elementType:dt,to:t?"/billing/change-plan":"/pricing",variant:"outline",color:"primary",size:"xs",children:s.jsx(d,{message:"Upgrade"})})})]}),s.jsx(Ri,{})]})}function Ri(){const e=ee();return s.jsx(gi,{onChange:()=>{e(_.path)},className:"w-full px-24 py-18 border-t flex-shrink-0 mt-auto"})}function Ti(e){return E.get("drive/file-entries",{params:e}).then(t=>t.data)}const _i=e=>{var a;const n=e.pages[0].folder,r=p().activePage;return n&&r&&r.id===n.hash&&(!r.folder||!$n(n.permissions,(a=r.folder)==null?void 0:a.permissions))&&p().setActivePage(bs(n)),e};function on(){const e=w(l=>l.activePage),t=w(l=>l.sortDescriptor),[n]=Xe(),{workspaceId:r}=K(),a={pageId:e==null?void 0:e.id,...e==null?void 0:e.queryParams,...Object.fromEntries(n),folderId:e!=null&&e.isFolderPage?e.id:null,workspaceId:r,...t},i=e===H&&!a.query&&!a.filters,o=Et(R.fetchEntries(a),({pageParam:l=1})=>Ti({...a,page:l}),{getNextPageParam:l=>{const c=l.current_page,u=l.last_page;if(!(c>=u))return c+1},enabled:e!=null&&!i});return h.useEffect(()=>{var l;(l=o.data)!=null&&l.pages[0].folder&&_i(o.data)},[o.data]),o}function zi(){return C.getQueriesData(R.fetchEntries()).reduce((t,n)=>{const r=n[1]?n[1].pages.flatMap(a=>a.data):[];return[...t,...r]},[])}const ln=[nr,{key:"owner_id",label:f("Owner"),description:f("User file was uploaded by"),defaultOperator:Re.eq,control:{type:Te.Select,defaultValue:"02",options:[{key:"01",label:f("anyone"),value:{value:null,operator:"!="}},{key:"02",label:f("me"),value:"{authId}"},{key:"03",label:f("not me"),value:{value:"{authId}",operator:"!="}}]}},rr({description:f("Date file was uploaded")}),ar({description:f("Date file was last changed")}),{key:"deleted_at",label:f("In trash"),description:f("Only show files that are in the trash"),defaultOperator:Re.ne,control:{type:Te.BooleanToggle,defaultValue:null}},{key:"shareableLink",label:f("Has shareable link"),description:f("Only show files that have a shareable link"),defaultOperator:Re.has,control:{type:Te.BooleanToggle,defaultValue:"*"}},{control:{type:Te.BooleanToggle,defaultValue:!0},key:"sharedByMe",label:f("Shared by me"),description:f("Only show files that are shared with someone"),defaultOperator:Re.eq}],$i=ln.map(e=>e.key);function Oi(){const e=w(l=>l.activePage),{isMobileMode:t}=h.useContext(se),{trans:n}=B(),r=ee(),[a]=Xe(),[i,o]=h.useState(a.get("query")||"");return e!==H?null:s.jsxs("div",{className:"mt-10 mb-30 px-10 md:px-26",children:[t&&s.jsx("form",{className:"contents",onSubmit:l=>{var c;l.preventDefault(),((c=document.activeElement)==null?void 0:c.tagName)==="INPUT"&&document.activeElement.blur(),r({pathname:H.path,search:`?query=${i}`},{replace:!0})},children:s.jsx(qe,{autoFocus:!0,className:"mb-20",startAdornment:s.jsx(M,{type:"submit",radius:"rounded",children:s.jsx(Ze,{})}),placeholder:n(f("Type to search")),value:i,onChange:l=>o(l.target.value)})}),s.jsx(ir,{filters:ln,pinnedFilters:$i})]})}function Bi(e,t){const n={...e};n.left=Math.max(0,n.left);const r=n.left-e.left;r>0&&(n.width-=r),n.top=Math.max(0,n.top);const a=n.top-e.top;return a>0&&(n.height-=a),n.width=Math.min(n.width,t.width-n.left),n.height=Math.min(n.height,t.height-n.top),n}const we=new Map;function Ui(e){const{id:t,ref:n}=e,r=h.useRef(e);r.current=e,h.useLayoutEffect(()=>{if(n.current)return we.set(t,{...we.get(t),id:t,ref:n,onSelected:()=>{var a,i;(i=(a=r.current).onSelected)==null||i.call(a)},onDeselected:()=>{var a,i;return(i=(a=r.current).onDeselected)==null?void 0:i.call(a)}}),()=>{yt.delete(t)}},[t,r,n])}function Wi(e,t){return!e||!t?!1:e.left<=t.left+t.width&&e.left+e.width>=t.left&&e.top<=t.top+t.height&&e.top+e.height>=t.top}function Vi({onPointerDown:e,...t}={}){const n=h.useRef(null),r=t.containerRef||n,a=h.useRef(null);let i=h.useRef({}).current;const o=()=>{var S,z,k,de,Me,Ae,Le;if(i.rafId&&cancelAnimationFrame(i.rafId),!i.startPoint||!i.endPoint||!i.boundaryRect)return;const c=i.startPoint,u=i.endPoint,x=c.scrollTop||0,m=((S=r.current)==null?void 0:S.scrollTop)||0,g={left:Math.min(c.x,u.x),top:Math.min(c.y,u.y),width:Math.abs(c.x-u.x),height:Math.abs(c.y-u.y)};g.left-=i.boundaryRect.left,g.top-=i.boundaryRect.top,g.top+=x;const v=m-x,y=Math.abs(v);v<0&&(g.top-=y),g.height+=y;const j=i.boundaryRect?Bi(g,i.boundaryRect):{...g};a.current&&(i.rafId=requestAnimationFrame(()=>{a.current&&(a.current.style.display="block",a.current.style.transform=`translate(${j.left}px, ${j.top}px)`,a.current.style.width=`${j.width}px`,a.current.style.height=`${j.height}px`),i.rafId=void 0}));const b={...j,left:j.left+i.boundaryRect.left,top:j.top+i.boundaryRect.top-m};for(const[,I]of we){const ye=Wi(I.rect,b);ye&&!((z=i.selectedIds)!=null&&z.has(I.id))?((k=i.selectedIds)==null||k.add(I.id),(de=I.onSelected)==null||de.call(I)):!ye&&((Me=i.selectedIds)!=null&&Me.has(I.id))&&((Ae=i.selectedIds)==null||Ae.delete(I.id),(Le=I.onDeselected)==null||Le.call(I))}};return{containerProps:{...wt({minimumMovement:4,onPointerDown:e,onMoveStart:c=>{if(or)return!1;zs(we),i={selectedIds:new Set};const u=r.current;if(i.startPoint={x:c.clientX,y:c.clientY,scrollTop:(u==null?void 0:u.scrollTop)||0},i.scrollListener=x=>{var m;i.startPoint&&(zs(we),(m=i.boundaryRect)!=null&&m.height&&(i.boundaryRect.height=x.target.scrollHeight),o())},u){const x=u.getBoundingClientRect();u.addEventListener("scroll",i.scrollListener),i.boundaryRect={top:x.top,left:x.left,height:u.scrollHeight,heightWithoutScroll:x.height,width:u.scrollWidth}}},onMove:c=>{if(i.endPoint={x:c.clientX,y:c.clientY},i.boundaryRect&&r.current){const u=c.clientY+20>i.boundaryRect.heightWithoutScroll+i.boundaryRect.top,x=c.clientY-20<i.boundaryRect.top;u?r.current.scrollBy({top:10}):x&&r.current.scrollBy({top:-10})}o()},onMoveEnd:()=>{i.rafId&&cancelAnimationFrame(i.rafId),r.current&&i.scrollListener&&r.current.removeEventListener("scroll",i.scrollListener),a.current&&(a.current.style.display="none",a.current.style.transform="",a.current.style.width="",a.current.style.height=""),i={}}}).domProps,ref:r},boxProps:{ref:a}}}function Ps(){const e=on();return e.data?e.data.pages.flatMap(t=>t.data):[]}function Ns(){const e=w(n=>n.selectedEntries),t=Ps();return Array.from(e).map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function cn(){return Ns()[0]}function Ki(){const e=cn(),{data:t}=ks();if(!(!e||!t))return t.folders.find(n=>n.id===e.parent_id)}function Fs(){const e=Array.from(p().selectedEntries),t=zi();return e.map(n=>t.find(r=>r.id===n)).filter(n=>!!n)}function dn({className:e}){const t=Ns();return t.length?s.jsx("div",{className:e,children:s.jsx(Qi,{entries:t})}):null}function Qi({entries:e}){const t=Tt(e),n=ys(e),r=_t(e),a=zt(e),i=[t,n,r,a].filter(o=>!!o);return s.jsxs("div",{className:"entry-action-list",children:[i.map(o=>s.jsx(ae,{label:s.jsx(d,{...o.label}),children:s.jsx(M,{size:"sm",onClick:()=>{o.execute()},children:h.createElement(o.icon)})},o.key)),s.jsx(ss,{entries:e,children:s.jsx(ae,{label:s.jsx(d,{message:"More actions"}),children:s.jsx(M,{children:s.jsx(fs,{})})})})]})}function qi(){var a;const e=Ns(),t=w(i=>i.activePage),n=w(i=>i.contextMenuData),r=n!=null&&n.entry?[n.entry]:e;return((a=n==null?void 0:n.entry)==null?void 0:a.id)===0?s.jsx(Hs,{position:n,page:_}):n&&r.length?s.jsx(Hi,{entries:r,position:n}):n&&t?s.jsx(Hs,{position:n,page:t}):null}function Hi({entries:e,position:t}){const n=Rt(e);return s.jsx(un,{position:t,actions:n})}function Hs({page:e,position:t}){const n=Ot(e);return s.jsx(un,{position:t,actions:n})}function un({position:e,actions:t}){return s.jsx(On,{position:e,onOpenChange:n=>{n||p().setContextMenuData(null)},children:t.map(n=>s.jsx(L,{value:n.key,onSelected:n.execute,startIcon:h.createElement(n.icon),children:s.jsx(d,{...n.label})},n.key))})}function Yi(){return Bn("((pointer: coarse))")}function mn(e){const t=Yi(),n=h.useRef(null),{onDrop:r}=en(e),[a,i]=h.useState(!1),o=w(m=>m.entriesBeingDragged.includes(e.id)),l=w(m=>m.activePage),{draggableProps:c}=bt({disabled:!!t||l===A,id:e.id,type:"fileEntry",ref:n,hidePreview:!0,onDragStart:(m,g)=>{p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setEntriesBeingDragged(g.getData().map(v=>v.id))},onDragEnd:()=>{p().setEntriesBeingDragged([])},getData:()=>Fs()}),{droppableProps:u}=Je({id:e.id,disabled:t||e.type!=="folder",ref:n,types:["fileEntry","nativeFile"],acceptsDrop:m=>ns(m,e),onDragEnter:()=>i(!0),onDragLeave:()=>i(!1),onDrop:r});Ui({id:e.id,ref:n,onSelected:()=>{p().selectEntries([e.id],!0)},onDeselected:()=>{p().deselectEntries([e.id])}});const x=D(o&&"opacity-20",a&&"ring ring-offset-4 ring-primary bg-primary-light/10 rounded");return{draggableProps:c,droppableProps:u,isDragOver:a,isDragging:o,itemClassName:x,ref:n}}function Gi({item:e,children:t,className:n,...r}){const{isCollapsedMode:a}=h.useContext(ms),{draggableProps:i,droppableProps:o,itemClassName:l,ref:c}=mn(e);return s.jsx("div",{className:D(n,l),ref:c,...Ge(i,o,r,{onContextMenu:u=>{u.preventDefault(),u.stopPropagation(),a||(p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setContextMenuData({x:u.clientX,y:u.clientY}))}}),children:t})}function fn(){const e=ee();return{performViewItemAction:h.useCallback(n=>{if(n&&n.type==="folder")p().activePage===A?p().setActiveActionDialog("trashFolderBlock",[n]):e(es(n.hash));else{const r=Fs();p().setActiveActionDialog("preview",r.length?r:[n])}},[e])}}function Xi({entries:e}){const{performViewItemAction:t}=fn(),n=w(i=>i.selectedEntries),r=w(i=>i.sortDescriptor),a=h.useMemo(()=>[...n],[n]);return s.jsx(ft,{columns:ws,data:e,sortDescriptor:r,onSortChange:i=>{p().setSortDescriptor(i)},onAction:t,selectedRows:a,selectionStyle:"highlight",renderRowAs:Gi,onSelectionChange:i=>{p().selectEntries(i)}})}function Zi({entry:e}){const t=w(v=>v.selectedEntries.has(e.id)),{performViewItemAction:n}=fn(),{isMobileMode:r}=h.useContext(se),{draggableProps:a,droppableProps:i,itemClassName:o,ref:l}=mn(e),c=()=>{t?p().deselectEntries([e.id]):p().selectEntries([e.id],!0)},u=(v,y)=>{r?p().selectedEntries.size?c():n(e):lr(v)?c():p().selectEntries([e.id])},{domProps:x}=wt({onLongPress:r?()=>c():void 0,onPress:u}),m=v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),v.stopPropagation(),n(e))},g=v=>{v.preventDefault(),v.stopPropagation(),r||(p().selectedEntries.has(e.id)||p().selectEntries([e.id]),p().setContextMenuData({x:v.clientX,y:v.clientY}))};return s.jsx(Nt,{...Ge(a,i,x,{onKeyDown:Ue(m)}),ref:l,entry:e,isSelected:t,isMobileMode:!!r,tabIndex:-1,onDoubleClick:v=>{v.preventDefault(),v.stopPropagation(),r||n(e)},footerAdornment:r&&s.jsx(Ji,{entry:e,isSelected:t}),onContextMenu:Ue(g),className:o})}function Ji({entry:e,isSelected:t}){return w(r=>r.selectedEntries.size)?s.jsx(nt,{className:"block mr-8",checked:t}):s.jsx(ss,{entries:[e],children:s.jsx(M,{className:"text-muted",onPointerDown:r=>{r.stopPropagation()},children:s.jsx(fs,{})})})}function eo({entries:e}){return s.jsx("div",{className:"file-grid-container",children:s.jsx("div",{className:"file-grid",children:e.map(t=>s.jsx(Zi,{entry:t},t.id))})})}function hn({isDisabled:e}){const t=w(n=>n.sortDescriptor);return s.jsx(Qt,{isDisabled:e,descriptor:t,onChange:n=>{p().setSortDescriptor(n)}})}function xn({className:e}){const{isMobileMode:t}=h.useContext(se),n=ee(),r=w(x=>x.activePage),a=r==null?void 0:r.folder,i=Kt({hash:a==null?void 0:a.hash,isEnabled:(a==null?void 0:a.hash)!==_.folder.hash}),o=ut(),l=so(),c=!r||!o||r.isFolderPage&&!a||i.fetchStatus!=="idle";let u;if(c)u=null;else{const x=l?[l]:[];i.data&&i.data.path.forEach(m=>{x.push({page:bs(m),label:m.name})}),u=s.jsx(js,{className:e,size:t?"md":"lg",currentIsClickable:!0,children:x.map((m,g)=>g===x.length-1?s.jsx(Ke,{children:({isMenuItem:y})=>y||!m.page.folder&&m.page!==A?s.jsx(ze,{value:m.label}):s.jsx(ss,{page:m.page,children:s.jsxs(ct,{className:"flex items-center gap-2 rounded focus-visible:ring-offset-4",children:[s.jsx(ze,{value:m.label}),s.jsx(cs,{className:"icon-md text-muted"})]})})},m.page.id):s.jsx(Ke,{onSelected:()=>{n(m.page.path)},children:s.jsx(ze,{value:m.label})},m.page.id))})}return u}function so(){var r,a;const e=w(i=>i.activePage),t=ut(),{user:n}=W();if(!e)return null;if(t&&!t.default&&e!=null&&e.isFolderPage&&((e==null?void 0:e.id)===_.id||((r=e.folder)==null?void 0:r.workspace_id)===t.id))return{label:t.name,page:_};if(e!=null&&e.isFolderPage){const i=(a=e.folder)==null?void 0:a.users.find(o=>o.owns_entry);return(i==null?void 0:i.id)!==(n==null?void 0:n.id)?{label:ge.label,page:ge}:{label:_.label,page:_}}return{label:e.label,page:e}}function to({query:{isInitialLoading:e,fetchNextPage:t,isFetchingNextPage:n,hasNextPage:r},children:a,loaderMarginTop:i="mt-24",style:o,className:l,variant:c="infiniteScroll",loadMoreExtraContent:u,size:x="md"}){const m=h.useRef(null),g=n||e,[v,y]=h.useState(0),j=c==="loadMore"&&v<3?"loadMore":"infiniteScroll";h.useEffect(()=>{const S=m.current;if(!S||j==="loadMore")return;const z=new IntersectionObserver(([k])=>{k.isIntersecting&&r&&!g&&t()});return z.observe(S),()=>{z.unobserve(S)}},[t,r,g,j]);let b;return a?b=n?a:null:j==="loadMore"?b=!e&&r&&s.jsxs("div",{className:D("flex items-center gap-8",i),children:[u,s.jsx(P,{size:x==="md"?"sm":"xs",className:D(x==="sm"?"min-h-24 min-w-96":"min-h-36 min-w-112"),variant:"outline",color:"primary",onClick:()=>{t(),y(v+1)},disabled:g,children:v>=2&&!n?s.jsx(d,{message:"Load all"}):s.jsx(d,{message:"Show more"})})]}):b=s.jsx(Q,{children:n&&s.jsx($.div,{className:D("flex justify-center w-full",i),...os,children:s.jsx(pe,{size:x,isIndeterminate:!0,"aria-label":"loading"})})}),s.jsxs("div",{style:o,className:D("w-full",l,r&&"min-h-36"),role:"presentation",children:[s.jsx("div",{ref:m,"aria-hidden":!0}),b]})}function no({isVisible:e}){const t=s.jsx($.div,{...os,transition:{duration:.3},className:"absolute inset-0 w-full min-h-full bg-primary-light/30 border-2 border-dashed border-primary pointer-events-none",children:s.jsx($.div,{initial:{y:"100%",opacity:0},animate:{y:"-10px",opacity:1},exit:{y:"100%",opacity:0},className:"p-10 bg-primary text-on-primary fixed bottom-0 left-0 right-0 max-w-max mx-auto rounded",children:s.jsx(d,{message:"Drop files to upload them to this folder."})})},"dragTargetMask");return s.jsx(Q,{children:e?t:null})}function ro({className:e}){const[t]=Xe(),n=!!t.get("query")||!!t.get("filters"),r=h.useRef(null),a=on(),i=Ps(),{uploadFiles:o}=Ce(),l=Fe(),c=w(k=>k.activePage),[u,x]=h.useState(!1),m=w(k=>k.viewMode),{isMobileMode:g}=h.useContext(se),{containerProps:v,boxProps:y}=Vi({containerRef:r,onPointerDown:k=>{k.target.closest(".entry-action-list")||p().deselectEntries("all")}}),{droppableProps:j}=Je({id:"driveRoot",ref:r,types:["nativeFile"],disabled:!(c!=null&&c.canUpload),onDragEnter:()=>{x(!0)},onDragLeave:()=>{x(!1)},onDrop:async k=>{k.type==="nativeFile"&&o(await k.getData())}});if(!c)return null;let b;if(!i.length&&(!a.isLoading||a.fetchStatus==="idle")){const k=c.noContentMessage(n);b=s.jsx(Ye,{className:"mt-40",image:s.jsx(ke,{src:k.image}),title:s.jsx(d,{...k.title}),description:s.jsx(d,{...k.description})})}else a.isLoading||(b=m==="list"?s.jsx(Xi,{entries:i}):s.jsx(eo,{entries:i}));const S=k=>{k.preventDefault(),k.stopPropagation(),p().deselectEntries("all"),p().setContextMenuData({x:k.clientX,y:k.clientY})},z=k=>{k.key==="a"&&cr(k)&&(k.preventDefault(),k.stopPropagation(),p().selectEntries(i.map(de=>de.id))),k.key==="Delete"&&(k.preventDefault(),k.stopPropagation(),p().selectedEntries.size&&!l.isLoading&&(c===A?p().setActiveActionDialog("confirmAndDeleteForever",Fs()):(l.mutate({entryIds:[...p().selectedEntries],deleteForever:c===A}),p().selectEntries([]))))};return s.jsx("div",{className:D("relative outline-none",e),tabIndex:-1,...Ge(v,j,{onKeyDown:Ue(z)}),onContextMenu:S,children:s.jsxs("div",{className:"flex flex-col relative pt-10 min-h-full",children:[g?s.jsx(xn,{className:"px-14 mb-10"}):s.jsx(ao,{}),s.jsx(Oi,{}),s.jsxs("div",{className:"px-18 md:px-24 pb-18 flex-auto relative",children:[s.jsx(is,{slot:"drive",className:"mb-24"}),b,s.jsx(to,{query:a})]}),s.jsx("div",{...y,className:"absolute bg-primary-light/20 border border-primary-light z-10 pointer-events-none shadow-md left-0 top-0 hidden"}),s.jsx(qi,{}),s.jsx(no,{isVisible:u})]})})}function ao(){const e=w(t=>t.activePage);return s.jsxs("div",{className:"px-10 md:px-18 my-10 flex items-center gap-40 justify-between text-muted min-h-42",children:[s.jsx(hn,{isDisabled:e==null?void 0:e.disableSort}),s.jsx(dn,{className:"text-muted"})]})}const io=h.memo(({file:e,style:t})=>s.jsxs("div",{className:"p-10 flex items-center gap-14 w-full absolute top-0 left-0",style:t,children:[s.jsx("div",{className:"shrink-0 border rounded p-8",children:s.jsx(Se,{className:"w-22 h-22",mime:e.mime})}),s.jsxs("div",{className:"flex-auto min-w-0 pr-10",children:[s.jsx("div",{className:"mb-2 flex items-center min-w-0 gap-10",children:s.jsx("div",{className:"flex-auto font-medium whitespace-nowrap min-w-0 overflow-hidden overflow-ellipsis",children:e.name})}),s.jsx(oo,{file:e})]}),s.jsx("div",{className:"mr-10",children:s.jsx(lo,{file:e})})]}));function oo({file:e}){const t=X(o=>o.fileUploads.get(e.id)),n=(t==null?void 0:t.bytesUploaded)||0,r=h.useMemo(()=>xe(e.size),[e]),a=h.useMemo(()=>xe(n),[n]);let i;return(t==null?void 0:t.status)==="completed"?i=s.jsx(d,{message:"Upload complete"}):(t==null?void 0:t.status)==="aborted"?i=s.jsx(d,{message:"Upload cancelled"}):(t==null?void 0:t.status)==="failed"?i=s.jsx(d,{message:"Upload failed"}):i=s.jsx(d,{message:":bytesUploaded of :totalBytes",values:{bytesUploaded:a,totalBytes:r}}),s.jsx("div",{className:"text-muted text-xs",children:i})}function lo({file:e}){const t=X(m=>m.fileUploads.get(e.id)),n=X(m=>m.abortUpload),r=(t==null?void 0:t.percentage)||0,a=t==null?void 0:t.status,i=t==null?void 0:t.errorMessage,[o,l]=h.useState(!1),c=s.jsx(M,{size:"sm",onClick:()=>{n(e.id)},children:s.jsx(be,{})}),u=s.jsx(pe,{"aria-label":"Upload progress",size:"sm",value:r});let x;if(a==="failed"){const m=i||f("This file could not be uploaded");x=s.jsx(_e,{children:s.jsx(ae,{variant:"danger",label:s.jsx(ze,{value:m}),children:s.jsx(Un,{className:"text-danger",size:"md"})})})}else a==="aborted"?x=s.jsx(_e,{children:s.jsx(Wn,{className:"text-warning",size:"md"})}):a==="completed"?x=s.jsx(_e,{children:s.jsx(Vn,{size:"md",className:"text-positive"})}):x=s.jsx(_e,{onPointerEnter:m=>{m.pointerType==="mouse"&&l(!0)},onPointerLeave:m=>{m.pointerType==="mouse"&&l(!1)},children:o?c:u});return s.jsx(Q,{children:x})}function _e({children:e,...t}){return s.jsx($.div,{...t,initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},children:e})}function co(){const e=w(t=>t.uploadQueueIsOpen);return s.jsx(Q,{children:e&&s.jsxs($.div,{className:"shadow-xl rounded fixed bottom-16 right-16 bg z-modal border w-375 text-sm",initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},children:[s.jsx(uo,{}),s.jsx(mo,{})]},"upload-queue")})}function uo(){const e=X(a=>a.activeUploadsCount),t=X(a=>a.completedUploadsCount),n=X(a=>a.clearInactive);let r;return e?r=s.jsx(d,{message:"Uploading :count files",values:{count:e}}):t?r=s.jsx(d,{message:"Uploaded :count files",values:{count:t}}):r=s.jsx(d,{message:"No active uploads"}),s.jsxs("div",{className:"px-10 py-4 bg-alt flex items-center gap-10 justify-between border-b min-h-[45px]",children:[r,e===0?s.jsx(M,{size:"sm",onClick:()=>{p().setUploadQueueIsOpen(!1),setTimeout(()=>{n()},200)},children:s.jsx(be,{})}):void 0]})}function mo(){const e=X(a=>a.fileUploads),t=[...e.values()],n=h.useRef(null),r=dr({count:e.size,getScrollElement:()=>n.current,estimateSize:()=>60,overscan:4});return s.jsx("div",{className:"max-h-320 overflow-y-auto",ref:n,children:s.jsx("div",{className:"relative w-full",style:{height:`${r.getTotalSize()}px`},children:r.getVirtualItems().map(a=>{const i=t[a.index];return s.jsx(io,{style:{height:`${a.size}px`,transform:`translateY(${a.start}px)`},file:i.file},i.file.id)})})})}const fo=""+new URL("detailed-examination-33c85772.svg",import.meta.url).href;function pn({entryType:e,entryName:t}){const{setRightSidenavStatus:n}=h.useContext(se);return s.jsxs("div",{className:"flex items-center gap-16 text-text-main mb-38",children:[s.jsx(Se,{className:"w-24 h-24",type:e}),s.jsx("div",{className:"text-xl font-normal text-ellipsis flex-auto mr-auto min-w-0 break-words",children:t}),s.jsx(M,{size:"md",className:"flex-shrink-0",onClick:()=>{n("closed")},children:s.jsx(be,{})})]})}function Cs({children:e,margin:t="mb-20"}){return s.jsx("div",{className:D("text-base text-main",t),children:e})}function ho(){return F(e=>xo(e),{onSuccess:()=>{O()},onError:e=>T(e,f("Failed to save tags."))})}function xo({entry:e,tags:t}){return E.post(`file-entries/${e.id}/sync-tags`,{tags:t.map(n=>n.name)}).then(n=>n.data)}function po(e){return le(["file-entry-tags",e],()=>go(e),{keepPreviousData:!0})}async function go(e){return E.get("file-entry-tags",{params:{query:e}}).then(t=>t.data)}function vo({entry:e}){return s.jsxs("div",{className:"mt-20 border-t pt-20",children:[s.jsx(Cs,{margin:"mb-10",children:s.jsx(d,{message:"Tags"})}),s.jsx(jo,{entry:e},e.id)]})}function jo({entry:e}){const{trans:t}=B(),n=ee(),r=ho(),[a,i]=h.useState(""),[o,l]=h.useState(e.tags||[]),{data:c,isLoading:u}=po(a),x=m=>{l(m),r.isLoading||r.mutate({tags:m,entry:e})};return s.jsx(hs,{isAsync:!0,inputValue:a,onInputValueChange:i,suggestions:c==null?void 0:c.results,placeholder:t(f("+Add tag")),isLoading:u,chipSize:"sm",value:o,onChange:x,onChipClick:m=>{n(`/drive/search?query=${m.name}`)},children:c==null?void 0:c.results.map(m=>s.jsx(L,{value:m,children:m.name},m.id))})}function bo({entry:e}){return s.jsxs("div",{children:[s.jsx(pn,{entryType:e.type,entryName:e.name}),e.type==="image"&&s.jsx(ds,{className:"mb-20",file:e}),s.jsxs("div",{children:[s.jsx(Cs,{children:s.jsx(d,{message:"Who has access"})}),s.jsxs("div",{className:"flex items-center gap-14",children:[e.workspace_id?s.jsx("div",{className:"rounded-full border w-32 h-32 flex items-center justify-center",children:s.jsx(Cr,{className:"icon-md"})}):null,e.users.map(t=>s.jsx(ae,{label:t.display_name,children:s.jsx(xs,{src:t.avatar,size:"md",circle:!0})},t.id))]}),e.permissions["files.update"]&&s.jsx(P,{className:"block mt-20",variant:"link",color:"primary",onClick:()=>{p().setActiveActionDialog("share",[e])},children:s.jsx(d,{message:"Manage Access"})})]}),s.jsx(yo,{entry:e}),s.jsx(vo,{entry:e})]})}function yo({entry:e}){const t=Ki(),n=ee(),r=e.users.find(i=>i.owns_entry),a=h.useMemo(()=>xe(e.file_size),[e.file_size]);return s.jsxs("div",{className:"mt-20 border-t pt-20",children:[s.jsx(Cs,{children:s.jsx(d,{message:"Properties"})}),s.jsx(me,{label:s.jsx(d,{message:"Type"}),value:s.jsx("span",{className:"capitalize",children:s.jsx(d,{message:e.type})})}),s.jsx(me,{label:s.jsx(d,{message:"Size"}),value:e.file_size?a:"-"}),s.jsx(me,{label:s.jsx(d,{message:"Location"}),value:s.jsx(P,{variant:"link",startIcon:s.jsx(vs,{}),onClick:()=>{n(t?es(t.hash):_.path)},children:t?t.name:s.jsx(d,{message:"Root"})})}),r&&s.jsx(me,{label:s.jsx(d,{message:"Owner"}),value:r.display_name}),s.jsx(me,{label:s.jsx(d,{message:"Modified"}),value:s.jsx(Be,{date:e.updated_at})}),s.jsx(me,{label:s.jsx(d,{message:"Created"}),value:s.jsx(Be,{date:e.updated_at})})]})}function me({label:e,value:t}){return s.jsxs("div",{className:"flex items-center mb-14",children:[s.jsx("div",{className:"w-1/3 text-xs text-muted",children:e}),s.jsx("div",{className:"w-2/3 text-sm text-main",children:t})]})}function wo({className:e}){const t=cn();return s.jsx("div",{className:D(e,"bg p-18 text-sm text-muted border-l h-full overflow-y-auto"),children:t?s.jsx(bo,{entry:t}):s.jsx(So,{})})}function So(){return s.jsxs(h.Fragment,{children:[s.jsx(pn,{entryType:"folder",entryName:s.jsx(d,{message:"All files"})}),s.jsx(Ye,{image:s.jsx(ke,{src:fo}),description:s.jsx(d,{message:"Select file or folder to see details here"})})]})}function ko(e){return F(t=>Io(t),{onSuccess:(t,n)=>{O(),N(f(":oldName renamed to :newName",{values:{oldName:n.initialName,newName:t.fileEntry.name}}))},onError:t=>Ie(t,e)})}function Io({entryId:e,...t}){return E.put(`file-entries/${e}`,t).then(n=>n.data)}function Eo({entries:e}){var l;const{close:t,formId:n}=q(),r=(l=e[0])==null?void 0:l.name,a=Ee({defaultValues:{name:r}}),i=ko(a),o=c=>{i.mutate({entryId:e[0].id,name:c.name,initialName:r},{onSuccess:t})};return s.jsxs(Z,{children:[s.jsx(J,{children:s.jsx(d,{message:"Rename"})}),s.jsx(Y,{children:s.jsx(De,{onSubmit:o,form:a,id:n,children:s.jsx(Pe,{placeholder:"Enter a name...","aria-label":"Entry name",autoFocus:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),s.jsxs(ve,{children:[s.jsx(P,{variant:"flat",onClick:()=>t(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(P,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isLoading||!a.formState.isDirty,children:s.jsx(d,{message:"Save"})})]})]})}function Do({name:e,parentId:t}){return E.post("folders",{name:e,parentId:t===0?null:t}).then(n=>n.data)}function Po(e){return F(({name:t,parentId:n})=>Do({name:t,parentId:n}),{onSuccess:()=>O(),onError:t=>Ie(t,e)})}function gn({parentId:e}){const{close:t,formId:n}=q(),{trans:r}=B(),a=Ee({defaultValues:{name:r({message:"Untitled Folder"})}}),i=Po(a),o=l=>{i.mutate({...l,parentId:e},{onSuccess:c=>{t(c.folder),N(f("Folder created"))}})};return s.jsxs(Z,{children:[s.jsx(J,{children:s.jsx(d,{message:"New Folder"})}),s.jsx(Y,{children:s.jsx(De,{onSubmit:o,form:a,id:n,children:s.jsx(Pe,{placeholder:r({message:"Enter a name..."}),"aria-label":"Entry name",autoFocus:!0,autoSelectText:!0,name:"name",required:!0,minLength:3,maxLength:200})})}),s.jsxs(ve,{children:[s.jsx(P,{variant:"flat",onClick:()=>t(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(P,{form:n,type:"submit",variant:"flat",color:"primary",disabled:i.isLoading,children:s.jsx(d,{message:"Create"})})]})]})}function No({selectedEntry:e}){const t=Ps().filter(i=>i.type!=="folder"),n=t.findIndex(i=>i.id===(e==null?void 0:e.id)),[r,a]=h.useState(n);return s.jsx(ht,{allowDownload:e.permissions["files.download"],headerActionsLeft:s.jsx(Fo,{activeIndex:r,entries:t}),activeIndex:r,onActiveIndexChange:a,entries:t})}function Fo({activeIndex:e,entries:t}){const n=t[e],r=ys([n]);return!n||!r?null:s.jsxs(h.Fragment,{children:[s.jsx(M,{className:"md:hidden",onClick:()=>{r.execute()},children:h.createElement(r.icon)}),s.jsx(P,{className:"max-md:hidden",variant:"text",startIcon:h.createElement(r.icon),onClick:()=>{r.execute()},children:s.jsx(d,{...r.label})})]})}function Co({entryId:e,...t}){return E.post(`file-entries/${e}/share`,t).then(n=>n.data)}function Mo(){return F(e=>Co(e),{onSuccess:()=>{O()},onError:e=>{var t,n;if(et.isAxiosError(e)&&e.response){const r=e.response.data;(t=r.errors)!=null&&t.emails?N.danger((n=r.errors)==null?void 0:n.emails[0]):T(e)}}})}const Ao={edit:!0,view:!0,download:!0},he=[{key:"view",value:{view:!0},label:f("Can view")},{key:"download",value:{view:!0,download:!0},label:f("Can Download")},{key:"edit",value:Ao,label:f("Can edit")}];function vn({value:e,onChange:t}){return s.jsxs(ie,{selectedValue:e.key,selectionMode:"single",onSelectionChange:n=>{n!==e.key&&t(he.find(r=>r.key===n))},children:[s.jsx(P,{variant:"flat",color:"chip",size:"xs",endIcon:s.jsx(cs,{}),children:s.jsx(d,{...e.label})}),s.jsx(oe,{children:he.map(n=>s.jsx(L,{value:n.key,children:s.jsx(d,{...n.label})},n.key))})]})}function Lo(e){const{download:t,edit:n}=e.entry_permissions;return n?he.find(r=>r.key==="edit"):t?he.find(r=>r.key==="download"):he.find(r=>r.key==="view")}function Ro(){return F(e=>To(e),{onSuccess:()=>{O(),N(f("Updated user permissions"))},onError:e=>T(e,f("Could not update permissions"))})}function To({entryId:e,...t}){return E.put(`file-entries/${e}/change-permissions`,t).then(n=>n.data)}function _o({user:e,...t}){var r;const{auth:n}=h.useContext(Kn);return s.jsx(xs,{...t,label:e==null?void 0:e.display_name,src:e==null?void 0:e.avatar,link:(e==null?void 0:e.id)&&((r=n.getUserProfileLink)==null?void 0:r.call(n,e))})}function zo({className:e,entry:t}){if(!t)return null;const n=t.users;return s.jsxs("div",{className:D(e,"overflow-hidden"),children:[s.jsx("div",{className:"mb-14 text-sm",children:s.jsx(d,{message:"Who has access"})}),s.jsx(Q,{initial:!1,children:n.map(r=>s.jsx($o,{user:r,entry:t},r.id))})]})}function $o({user:e,entry:t}){return s.jsxs($.div,{initial:{x:"-100%",opacity:0},animate:{x:0,opacity:1},exit:{x:"100%",opacity:0},transition:{type:"tween",duration:.125},className:"flex items-center text-sm gap-14 mb-20",children:[s.jsx(_o,{user:e,circle:!0,size:"w-44 h-44"}),s.jsxs("div",{children:[s.jsx("div",{children:e.display_name}),s.jsx("div",{className:"text-muted",children:e.email})]}),s.jsx("div",{className:"ml-auto",children:e.owns_entry?s.jsx("span",{className:"text-muted",children:s.jsx(d,{message:"Owner"})}):s.jsx(Oo,{user:e,entry:t})})]},e.id)}function Oo({user:e,entry:t}){const n=Ro(),r=At(),[a,i]=h.useState(()=>Lo(e));return s.jsxs("div",{className:"flex items-center gap-10",children:[s.jsx(vn,{onChange:o=>{n.mutate({userId:e.id,permissions:o.value,entryId:t.id}),i(o)},value:a}),s.jsx(M,{onClick:()=>{r.mutate({userId:e.id,entryIds:[t.id]},{onSuccess:()=>{N(f("Member removed"))},onError:o=>T(o,f("Could not remove member"))})},children:s.jsx(be,{})})]})}function Bo({className:e,entry:t}){var b;const{trans:n}=B(),{share:r}=He(),a=Mo(),[i,o]=h.useState([]),[l,c]=h.useState(!1),[u,x]=h.useState(he[0]),m=i.every(S=>!S.invalid),[g,v]=h.useState(""),y=ur(mr,{perPage:7,query:g},{enabled:r.suggest_emails}),j=S=>S.description||S.name;return s.jsxs("div",{className:e,children:[s.jsx(hs,{value:i,onChange:o,isAsync:!0,isLoading:y.fetchStatus==="fetching",inputValue:g,onInputValueChange:v,suggestions:(b=y.data)==null?void 0:b.results,displayWith:j,validateWith:S=>{const z=!qt(S.description);return{...S,invalid:z,errorMessage:z?n({message:"Not a valid email"}):void 0}},placeholder:n({message:"Enter email addresses"}),label:s.jsx(d,{message:"Invite people"}),children:S=>s.jsx(L,{value:S.id,startIcon:s.jsx(xs,{circle:!0,src:S.image,alt:""}),description:S.description,children:S.name})}),s.jsxs("div",{className:"flex items-center gap-14 justify-between mt-14",children:[s.jsx(vn,{onChange:x,value:u}),i.length?s.jsx(P,{variant:"flat",color:"primary",size:"sm",disabled:l||!m,onClick:()=>{c(!0),a.mutate({emails:i.map(S=>j(S)),permissions:u.value,entryId:t.id},{onSuccess:()=>{o([])},onSettled:()=>{c(!1)}})},children:s.jsx(d,{message:"Share"})}):null]}),s.jsx(zo,{className:"mt-30",entry:t})]})}function jn(e){return le(R.fetchEntryShareableLink(e),()=>Uo(e),{enabled:!!e})}function Uo(e){return E.get(`file-entries/${e}/shareable-link`,{params:{loader:"shareableLink"}}).then(t=>t.data)}function Wo({entryId:e}){return E.delete(`file-entries/${e}/shareable-link`).then(t=>t.data)}function Vo(){return F(({entryId:e})=>Wo({entryId:e}),{onSuccess:(e,{entryId:t})=>{C.setQueryData(R.fetchEntryShareableLink(t),{...e,link:null})},onError:e=>T(e,f("Could not delete link"))})}function Ko(e=36){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let r=0;r<e;r+=1)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function Qo({setActivePanel:e,entry:t,focusInput:n}){var c,u;const r=jn(t.id),a=!!((c=r.data)!=null&&c.link),i=Ft(),o=Vo(),l=r.isLoading||i.isLoading||o.isLoading;return s.jsxs("div",{children:[s.jsx("div",{className:"mb-10",children:s.jsx(d,{message:"Share link"})}),s.jsxs("div",{className:"flex items-center gap-14 justify-between pb-4 px-2",children:[s.jsx(ps,{checked:a,disabled:l,onChange:()=>{a?o.mutate({entryId:t.id}):i.mutate({entryId:t.id})},children:a?s.jsx(d,{message:"Shareable link is created"}):s.jsx(d,{message:"Create shareable link"})}),a&&s.jsx(P,{variant:"link",color:"primary",onClick:()=>{e("linkSettings")},children:s.jsx(d,{message:"Link settings"})})]}),s.jsx(qo,{autoFocus:n,link:(u=r.data)==null?void 0:u.link})]})}function qo({link:e,autoFocus:t}){const{base_url:n}=He(),{trans:r}=B(),a=Hr(),i=(e==null?void 0:e.hash)||(a==null?void 0:a.hash)||Ko(),o=`${n}/drive/s/${i}`,[l,c]=Qn(o,{successDuration:1e3});return s.jsx(qe,{autoFocus:t,disabled:!e,className:"mt-10",readOnly:!0,value:o,"aria-label":r({message:"Shareable link"}),onFocus:u=>{u.target.select()},endAppend:s.jsx(P,{className:"min-w-100",variant:"flat",color:"primary",onClick:c,children:l?s.jsx(d,{message:"Copied!"}):s.jsx(d,{message:"Copy"})})})}function Ho({entryId:e,...t}){return E.put(`file-entries/${e}/shareable-link`,t).then(n=>n.data)}function Yo(e){return F(t=>Ho(t),{onSuccess:(t,{entryId:n})=>{C.setQueryData(R.fetchEntryShareableLink(n),t)},onError:t=>Ie(t,e)})}function Go({className:e,setActivePanel:t,entry:n}){const{formId:r}=q(),{data:a}=jn(n.id),i=a==null?void 0:a.link,o=Ee({defaultValues:{allowDownload:i==null?void 0:i.allow_download,allowEdit:i==null?void 0:i.allow_edit,expiresAt:i==null?void 0:i.expires_at,entryId:n.id}}),l=Yo(o);return s.jsxs(h.Fragment,{children:[s.jsx(J,{onDismiss:()=>{t("main")},children:s.jsx(d,{message:"Shareable Link Settings"})}),s.jsx(Y,{children:s.jsx($.div,{className:"min-h-[335px]",animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:s.jsxs(De,{id:r,className:e,form:o,onSubmit:c=>{l.mutate(c,{onSuccess:()=>{t("main"),N(f("Link settings saved"))}})},children:[s.jsx(Zo,{showField:!!(i!=null&&i.expires_at)}),s.jsx(Jo,{showField:!!(i!=null&&i.password)}),s.jsxs(Qe,{children:[s.jsx(d,{message:"Allow download"}),s.jsx($s,{name:"allowDownload",children:s.jsx(d,{message:"Users with link can download this item"})})]}),s.jsxs(Qe,{showBorder:!1,children:[s.jsx(d,{message:"Allow import"}),s.jsx($s,{name:"allowEdit",children:s.jsx(d,{message:"Users with link can import this item into their own drive"})})]})]})},"link-settings-content")}),s.jsxs(ve,{children:[s.jsx(P,{type:"button",onClick:()=>{t("main")},children:s.jsx(d,{message:"Cancel"})}),s.jsx(P,{type:"submit",form:r,variant:"flat",color:"primary",disabled:l.isLoading,children:s.jsx(d,{message:"Save"})})]})]})}const Xo=qn(Hn());function Zo({showField:e}){const{trans:t}=B(),[n,r]=h.useState(e);return s.jsxs(Qe,{children:[s.jsx(d,{message:"Link expiration"}),s.jsxs("div",{children:[s.jsx(ps,{checked:n,onChange:a=>{r(a.target.checked)},children:s.jsx(d,{message:"Link is valid until"})}),n&&s.jsx(fr,{min:Xo,name:"expiresAt",granularity:"minute",className:"mt-20","aria-label":t({message:"Link expiration date and time"})})]})]})}function Jo({showField:e}){const{trans:t}=B(),[n,r]=h.useState(e);return s.jsxs(Qe,{children:[s.jsx(d,{message:"Password protect"}),s.jsxs("div",{children:[s.jsx(ps,{checked:n,onChange:a=>{r(a.target.checked)},children:s.jsx(d,{message:"Users will need to enter password in order to view this link"})}),n&&s.jsx(Pe,{type:"password",autoFocus:!0,name:"password",className:"mt-20","aria-label":t({message:"Link password"}),description:s.jsx(d,{message:"Password will not be requested when viewing the link as file owner."}),placeholder:t({message:"Enter new password..."})})]})]})}function Qe({children:e,showBorder:t=!0}){const[n,r]=e;return s.jsxs("div",{className:D(t&&"border-b mb-20 pb-20"),children:[s.jsx("div",{className:"text-sm font-medium mb-8",children:n}),r]})}function Ys({entry:e,focusLinkInput:t}){const{data:{fileEntry:n}}=le(R.fetchFileEntry(e.id),()=>E.get(`drive/file-entries/${e.id}/model`).then(i=>i.data),{initialData:{fileEntry:e}}),[r,a]=h.useState("main");return s.jsx(Z,{size:"lg",children:s.jsx(Q,{initial:!1,mode:"wait",children:r==="linkSettings"?s.jsx(Go,{setActivePanel:a,entry:n},"one"):s.jsx(el,{setActivePanel:a,entry:n,focusLinkInput:t},"two")})})}function el({setActivePanel:e,entry:t,focusLinkInput:n}){return s.jsxs(h.Fragment,{children:[s.jsx(J,{children:s.jsx(d,{message:"Share ‘:name’",values:{name:t.name}})}),s.jsx(Y,{className:"relative",children:s.jsxs($.div,{animate:{opacity:1,y:0},initial:{opacity:0,y:20},exit:{opacity:0,y:-20},transition:{duration:.1},children:[s.jsx(Bo,{className:"border-b pb-30 mb-30",entry:t}),s.jsx(Qo,{setActivePanel:e,entry:t,focusInput:!!n})]},"share-content")})]})}function sl({allFolders:e,onFolderSelected:t}){const{trans:n}=B(),r=n({message:"Search folders"});return s.jsx(Yn,{size:"sm",maxItems:10,placeholder:r,"aria-label":r,className:"pt-20",endAdornmentIcon:s.jsx(Ze,{}),items:e,clearInputOnItemSelection:!0,onItemSelected:a=>{const i=parseInt(a),o=e.find(l=>l.id===i);o&&t(o)},children:a=>s.jsx(L,{value:a.id,children:a.name},a.id)})}function tl({selectedFolder:e,allFolders:t,rootFolder:n,onFolderSelected:r}){const a=e.path.split("/").map(l=>{const c=parseInt(l);return t.find(u=>c===u.id)}).filter(l=>!!l),i=[n,...a],o=a[a.length-2];return s.jsxs("div",{className:"flex items-center border-b pb-10 gap-6",children:[s.jsx(M,{className:"flex-shrink-0",variant:"outline",size:"xs",radius:"rounded",disabled:!o&&!e.id,onClick:()=>{r(o||n)},children:s.jsx(hr,{})}),s.jsx(js,{size:"sm",className:"flex-auto",children:i.map(l=>s.jsxs(Ke,{onSelected:()=>{r(l)},className:"flex items-center gap-8",children:[!l.id&&s.jsx(vs,{className:"icon-sm"}),l.name]},l.id||"root"))})]})}const nl=""+new URL("my-files-88476671.svg",import.meta.url).href;function rl(e){const{onFolderSelected:t,selectedFolder:n,allFolders:r}=e,a=h.useMemo(()=>{const i=n.id||null;return r.filter(o=>o.parent_id===i)},[n.id,r]);return a.length?s.jsx(Gn,{className:"h-288 overflow-y-auto",children:a.map(i=>s.jsx(Xn,{className:"border-b min-h-48",onSelected:()=>{t(i)},startIcon:s.jsx(Se,{type:"folder"}),endIcon:s.jsx(Tr,{size:"md"}),children:i.name},i.id))}):s.jsx(Ye,{size:"xs",className:"pt-64 pb-20 min-h-288",image:s.jsx(ke,{src:nl}),title:s.jsx(d,{message:'There are no subfolders in ":folder"',values:{folder:n.name}})})}function al({entries:e}){const{data:t}=ks(),n=(t==null?void 0:t.folders)||[],r=w(o=>o.activePage),[a,i]=h.useState((r==null?void 0:r.folder)||_.folder);return s.jsxs(Z,{size:"lg",children:[s.jsx(J,{children:s.jsx(d,{message:"Move [one ‘:name‘|other :count items]",values:{count:e.length,name:e[0].name}})}),s.jsxs(Y,{children:[s.jsx("div",{className:"text-sm",children:s.jsx(d,{message:"Select a destination folder."})}),s.jsx(sl,{allFolders:n,onFolderSelected:i}),s.jsxs("div",{className:"mb-20 mt-40",children:[s.jsx(tl,{selectedFolder:a,allFolders:n,rootFolder:_.folder,onFolderSelected:i}),s.jsx(rl,{selectedFolder:a,allFolders:n,onFolderSelected:i})]})]}),s.jsx(il,{selectedFolder:a,setSelectedFolder:i,entries:e})]})}function il({selectedFolder:e,setSelectedFolder:t,entries:n}){const{close:r}=q(),a=Jt();return s.jsxs(ve,{className:"border-t",startAction:s.jsxs(ce,{type:"modal",onClose:i=>{i&&t(i)},children:[s.jsx(P,{startIcon:s.jsx(gs,{}),variant:"text",children:s.jsx(d,{message:"New Folder"})}),s.jsx(gn,{parentId:e.id})]}),children:[s.jsx(P,{className:"max-md:hidden",variant:"flat",onClick:()=>r(),children:s.jsx(d,{message:"Cancel"})}),s.jsx(P,{type:"submit",variant:"flat",color:"primary",disabled:!Is(n,e)||a.isLoading,onClick:()=>{a.mutate({destinationId:e.id,entryIds:n.map(i=>i.id)},{onSuccess:r})},children:s.jsx(d,{message:"Move here"})})]})}function ol({entries:e}){const t=Fe(),{close:n}=q(),r=e.length===1?s.jsx(d,{message:"‘:name‘ will be deleted forever and you won't be able to restore it.",values:{name:e[0].name}}):s.jsx(d,{message:":count items will be deleted forever and you won't be able to restore them.",values:{count:e.length}});return s.jsx(je,{isDanger:!0,title:s.jsx(d,{message:"Delete forever?"}),body:r,confirm:s.jsx(d,{message:"Delete forever"}),isLoading:t.isLoading,onConfirm:()=>{t.mutate({entryIds:e.map(a=>a.id),deleteForever:!0},{onSuccess:()=>{n(),p().selectEntries([])}})}})}function ll({entries:e}){const t=Lt(),{close:n}=q();return s.jsx(je,{title:s.jsx(d,{message:"This folder is in your trash"}),body:s.jsx(d,{message:"To view this folder, restore it from the trash."}),confirm:s.jsx(d,{message:"Restore"}),isLoading:t.isLoading,onConfirm:()=>{t.mutate({entryIds:e.map(r=>r.id)},{onSuccess:()=>{n(),p().selectEntries([])}})}})}function cl(){const e=w(n=>n.activeActionDialog),t=dl(e);return s.jsx(ce,{type:"modal",isOpen:!!t,onClose:()=>{p().setActiveActionDialog(null)},children:t})}function dl(e){var t;switch(e==null?void 0:e.name){case"rename":return s.jsx(Eo,{entries:e.entries});case"newFolder":return s.jsx(gn,{parentId:(t=e.entries[0])==null?void 0:t.id});case"preview":return s.jsx(No,{selectedEntry:e.entries[0]});case"share":return s.jsx(Ys,{entry:e.entries[0]});case"getLink":return s.jsx(Ys,{entry:e.entries[0],focusLinkInput:!0});case"moveTo":return s.jsx(al,{entries:e.entries});case"confirmAndDeleteForever":return s.jsx(ol,{entries:e.entries});case"trashFolderBlock":return s.jsx(ll,{entries:e.entries});default:return null}}function ul(){const{trans:e}=B(),t=ee(),n=w(o=>o.activePage),[r]=Xe(),[a,i]=h.useState(r.get("query")||"");return s.jsx("form",{className:"flex-auto max-w-620",onSubmit:o=>{o.preventDefault(),t({pathname:H.path,search:`?query=${a}`},{replace:!0})},children:s.jsx(qe,{size:"sm",background:"bg-paper",value:a,onChange:o=>i(o.target.value),onFocus:()=>{n!==H&&t(H.path)},startAdornment:s.jsx(M,{type:"submit",radius:"rounded",children:s.jsx(Ze,{})}),className:"flex-auto max-w-620",placeholder:e({message:"Search"}),"aria-label":e({message:"Search files and folders"})})})}function ml(e){const t=h.useRef(e),n=h.useId();h.useEffect(()=>(Os.set(n,t.current),()=>{Os.delete(n)}),[n])}function fl(){const e=h.useRef(null),[t,n]=h.useState(),[r,a]=h.useState({});ml({type:"fileEntry",onDragStart:(o,l)=>{const c=l;c&&(a({entries:c.getData(),e:o,draggingTreeItem:Ii(c.id)}),n({start:o}))},onDragMove:o=>{a(l=>({...l,e:o})),n(l=>({...l,end:o}))},onDragEnd:(o,l,c)=>{a({status:c})}});let i=null;return r.entries&&r.e&&(i=s.jsx("div",{ref:e,style:r.e?{transform:`translate(${r.e.x}px, ${r.e.y}px)`,width:`${r.e.rect.width}px`}:void 0,className:"fixed isolate left-0 top-0 pointer-events-none",children:r.entries.map((o,l)=>s.jsx(hl,{index:l,entry:o,points:t,state:r},o.id))})),s.jsx(Q,{custom:r.status,children:i})}const hl=h.memo(({entry:e,points:t,index:n,state:r})=>{var x,m,g,v;const a=w(y=>y.viewMode),i=r.draggingTreeItem?Es(e):e.id,o=yt.get(i);if(!(o!=null&&o.rect)||!(t!=null&&t.start))return null;const l=o.rect,c=((x=r.entries)==null?void 0:x.length)||0,u=y=>{var j,b,S;return y==="dropSuccess"?{x:0,y:0,opacity:0,transition:{duration:.1,delay:0}}:{x:l.left-(((j=t.end)==null?void 0:j.x)||0),y:l.top-(((b=t.end)==null?void 0:b.y)||0),width:`${(S=r.e)==null?void 0:S.rect.width}px`}};return s.jsxs($.div,{transition:{delay:.01*n,bounce:0,duration:.2},initial:{x:l.left-t.start.x,y:l.top-t.start.y,width:`${(m=r.e)==null?void 0:m.rect.width}px`},animate:{x:0,y:0,width:a==="list"?288:void 0},exit:u,style:{width:a==="grid"?`${(g=r.e)==null?void 0:g.rect.width}px`:void 0,height:`${(v=r.e)==null?void 0:v.rect.height}px`},className:D("absolute bg-paper whitespace-nowrap rounded border border-primary-light max-h-48",n<2&&"shadow",n===0&&"z-10 top-0 left-0",n>0&&"top-6 left-6"),children:[c>1&&n===0&&s.jsx(xl,{count:c}),s.jsxs("div",{className:"text-sm h-full flex justify-center items-center px-16 gap-10 bg-primary-light/20 overflow-hidden",children:[s.jsx(Se,{type:e.type}),s.jsx("div",{className:"flex-auto text-ellipsis overflow-hidden",children:e.name})]})]},e.id)}),xl=h.memo(({count:e})=>s.jsx($.div,{initial:{opacity:0},animate:{opacity:1,transition:{delay:.1}},exit:{opacity:0},transition:{duration:.1},className:"absolute -top-6 shadow-lg -right-6 z-30 rounded-full bg-danger text-white w-20 h-20 flex items-center justify-center text-sm font-bold z-10",children:e},"entryCount"));function pl(){const{isMobileMode:e}=h.useContext(se),t=w(n=>n.activePage);return s.jsxs(Vt,{className:"px-8 md:px-26 py-4 flex items-center gap-20 border-b h-60",children:[e?s.jsx(hn,{isDisabled:t==null?void 0:t.disableSort}):s.jsx(xn,{}),s.jsxs("div",{className:"text-muted ml-auto flex-shrink-0",children:[s.jsx(gl,{}),s.jsx(vl,{})]})]})}function gl(){const e=w(n=>n.viewMode),t=e==="grid"?s.jsx(d,{message:"List view"}):s.jsx(d,{message:"Grid view"});return s.jsx(ae,{label:t,children:s.jsx(M,{size:"md",onClick:()=>{p().setViewMode(p().viewMode==="list"?"grid":"list")},children:e==="list"?s.jsx(Mr,{}):s.jsx(Ar,{})})})}function vl(){const{rightSidenavStatus:e,setRightSidenavStatus:t}=h.useContext(se),n=e?s.jsx(d,{message:"Hide details"}):s.jsx(d,{message:"Show details"});return s.jsx(ae,{label:n,children:s.jsx(M,{size:"md",color:e==="open"?"primary":null,onClick:()=>{t(e==="open"?"closed":"open")},children:s.jsx(Lr,{})})})}function re(){const{pathname:e}=rt(),{hash:t}=rs(),{workspaceId:n}=K(),r=w(i=>i.activePage);h.useEffect(()=>{p().setActivePage(ca.find(i=>i.path===e)||Mt(t))},[e,t]);const a=h.useMemo(()=>({workspaceId:n}),[n]);return h.useEffect(()=>()=>{p().reset()},[]),s.jsxs(h.Fragment,{children:[(r==null?void 0:r.label)&&s.jsx(Zn,{children:r.label}),s.jsxs(at,{children:[s.jsx(vt.Provider,{value:a,children:s.jsxs(xt,{name:"drive",onDragOver:i=>{i.preventDefault(),i.stopPropagation(),i.dataTransfer.dropEffect="none"},onDrop:i=>{i.preventDefault()},children:[s.jsx(jl,{}),s.jsx(Bs,{position:"left",size:"md",children:s.jsx(Li,{})}),s.jsx(pl,{}),s.jsx(gt,{children:s.jsx(ro,{})}),s.jsx(co,{}),s.jsx(cl,{}),s.jsx(Bs,{position:"right",size:"lg",children:s.jsx(wo,{})})]})}),s.jsx(fl,{})]})]})}function jl(){const{isMobileMode:e}=h.useContext(se),t=w(i=>i.activePage),n=e?null:s.jsx(ul,{}),r=s.jsx(M,{elementType:dt,to:H.path,children:s.jsx(Ze,{})}),a=s.jsxs(h.Fragment,{children:[t!==H&&r,s.jsx(an,{isCompact:!0})]});return s.jsxs(h.Fragment,{children:[s.jsx(pt,{rightChildren:e&&a,menuPosition:"drive-navbar",children:n}),e&&s.jsx(bl,{})]})}function bl(){const e=w(t=>t.selectedEntries.size);return e?s.jsxs("div",{className:"fixed bg-primary w-full h-54 text-on-primary shadow-xl z-10 rounded top-0 right-0 flex items-center justify-center gap-10 px-6",children:[s.jsx(M,{onClick:()=>{p().selectEntries([])},children:s.jsx(be,{})}),s.jsx(d,{message:":count selected",values:{count:e}}),s.jsx(dn,{className:"ml-auto"})]}):null}const yl=[{path:"/",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"/folders/:hash",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"/shares",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"/recent",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"/starred",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"/trash",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"/search",element:s.jsx(ne,{children:s.jsx(re,{})})},{path:"s/:hash",element:s.jsx(Ba,{})},{path:"*",element:s.jsx(it,{})}];function El(){return Jn(yl)}export{El as default};
//# sourceMappingURL=drive-routes-a57b1459.js.map
